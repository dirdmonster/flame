//木棉树软件
/*  1、DRACOLoader.js
 *  2、tween.js
 *  3、stats.js
 *  4、MTLLoader.js
 *  5、OBJLoader.js
 *  6、OrbitControls.js
 *  7、Lensflare.js
 *  8、Reflector.js
 *  9、Water.js
 *  10、MapControls.js
 *  11、GLTFLoader.js
 *  12、RGBELoader.js
 *  13、HDRCubeTextureLoader.js
 *  14、RGBELoader2.js（V108）
 *  15、EquirectangularToCubeGenerator.js
 *  16、FirstPersonControls.js
 */

THREE.DRACOLoader=function(a){this.timeLoaded=0;this.manager=a||THREE.DefaultLoadingManager;this.materials=null;this.verbosity=0;this.attributeOptions={};this.drawMode=THREE.TrianglesDrawMode;this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}};THREE.DRACOLoader.prototype={constructor:THREE.DRACOLoader,load:function(a,b,d,c){var e=this,g=new THREE.FileLoader(e.manager);g.setPath(this.path);g.setResponseType("arraybuffer");g.load(a,function(a){e.decodeDracoFile(a,b)},d,c)},setPath:function(a){this.path=a;return this},setVerbosity:function(a){this.verbosity=a;return this},setDrawMode:function(a){this.drawMode=a;return this},setSkipDequantization:function(a,b){var d=!0;"undefined"!==typeof b&&(d=b);this.getAttributeOptions(a).skipDequantization=d;return this},decodeDracoFile:function(a,b,d,c){var e=this;THREE.DRACOLoader.getDecoderModule().then(function(g){e.decodeDracoFileInternal(a,g.decoder,b,d,c)})},decodeDracoFileInternal:function(a,b,d,c,e){var g=new b.DecoderBuffer;g.Init(new Int8Array(a),a.byteLength);a=new b.Decoder;var f=a.GetEncodedGeometryType(g);if(f==b.TRIANGULAR_MESH)0<this.verbosity&&console.log("Loaded a mesh.");else if(f==b.POINT_CLOUD)0<this.verbosity&&console.log("Loaded a point cloud.");else throw console.error("THREE.DRACOLoader: Unknown geometry type."),Error("THREE.DRACOLoader: Unknown geometry type.");d(this.convertDracoGeometryTo3JS(b,a,f,g,c,e))},addAttributeToGeometry:function(a,b,d,c,e,g,f,k){if(0===g.ptr)throw a="THREE.DRACOLoader: No attribute "+c,console.error(a),Error(a);var n=g.num_components(),l=d.num_points()*n;switch(e){case Float32Array:e=new a.DracoFloat32Array;b.GetAttributeFloatForAllPoints(d,g,e);k[c]=new Float32Array(l);b=THREE.Float32BufferAttribute;break;case Int8Array:e=new a.DracoInt8Array;b.GetAttributeInt8ForAllPoints(d,g,e);k[c]=new Int8Array(l);b=THREE.Int8BufferAttribute;break;case Int16Array:e=new a.DracoInt16Array;b.GetAttributeInt16ForAllPoints(d,g,e);k[c]=new Int16Array(l);b=THREE.Int16BufferAttribute;break;case Int32Array:e=new a.DracoInt32Array;b.GetAttributeInt32ForAllPoints(d,g,e);k[c]=new Int32Array(l);b=THREE.Int32BufferAttribute;break;case Uint8Array:e=new a.DracoUInt8Array;b.GetAttributeUInt8ForAllPoints(d,g,e);k[c]=new Uint8Array(l);b=THREE.Uint8BufferAttribute;break;case Uint16Array:e=new a.DracoUInt16Array;b.GetAttributeUInt16ForAllPoints(d,g,e);k[c]=new Uint16Array(l);b=THREE.Uint16BufferAttribute;break;case Uint32Array:e=new a.DracoUInt32Array;b.GetAttributeUInt32ForAllPoints(d,g,e);k[c]=new Uint32Array(l);b=THREE.Uint32BufferAttribute;break;default:throw a="THREE.DRACOLoader: Unexpected attribute type.",console.error(a),Error(a);}for(d=0;d<l;d++)k[c][d]=e.GetValue(d);f.addAttribute(c,new b(k[c],n));a.destroy(e)},convertDracoGeometryTo3JS:function(a,b,d,c,e,g){!0===this.getAttributeOptions("position").skipDequantization&&b.SkipAttributeTransform(a.POSITION);var f,k,n=performance.now();d===a.TRIANGULAR_MESH?(f=new a.Mesh,k=b.DecodeBufferToMesh(c,f)):(f=new a.PointCloud,k=b.DecodeBufferToPointCloud(c,f));if(!k.ok()||0==f.ptr)throw n="THREE.DRACOLoader: Decoding failed: "+k.error_msg(),console.error(n),a.destroy(b),a.destroy(f),Error(n);k=performance.now();a.destroy(c);d==a.TRIANGULAR_MESH?(c=f.num_faces(),0<this.verbosity&&console.log("Number of faces loaded: "+c.toString())):c=0;var l=f.num_points(),m=f.num_attributes();0<this.verbosity&&(console.log("Number of points loaded: "+l.toString()),console.log("Number of attributes loaded: "+m.toString()));l=b.GetAttributeId(f,a.POSITION);if(-1==l)throw n="THREE.DRACOLoader: No position attribute found.",console.error(n),a.destroy(b),a.destroy(f),Error(n);var l=b.GetAttribute(f,l),p={},m=new THREE.BufferGeometry;if(e)for(var h in e){var r=g[h],q=b.GetAttributeByUniqueId(f,e[h]);this.addAttributeToGeometry(a,b,f,h,r,q,m,p)}else for(h in this.nativeAttributeMap)e=b.GetAttributeId(f,a[this.nativeAttributeMap[h]]),-1!==e&&(0<this.verbosity&&console.log("Loaded "+h+" attribute."),q=b.GetAttribute(f,e),this.addAttributeToGeometry(a,b,f,h,Float32Array,q,m,p));if(d==a.TRIANGULAR_MESH)if(this.drawMode===THREE.TriangleStripDrawMode){c=new a.DracoInt32Array;b.GetTriangleStripsFromMesh(f,c);p.indices=new Uint32Array(c.size());for(h=0;h<c.size();++h)p.indices[h]=c.GetValue(h);a.destroy(c)}else{p.indices=new Uint32Array(3*c);e=new a.DracoInt32Array;for(h=0;h<c;++h)b.GetFaceFromMesh(f,h,e),g=3*h,p.indices[g]=e.GetValue(0),p.indices[g+1]=e.GetValue(1),p.indices[g+2]=e.GetValue(2);a.destroy(e)}m.drawMode=this.drawMode;d==a.TRIANGULAR_MESH&&m.setIndex(new (65535<p.indices.length?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(p.indices,1));d=new a.AttributeQuantizationTransform;if(d.InitFromAttribute(l))for(m.attributes.position.isQuantized=!0,m.attributes.position.maxRange=d.range(),m.attributes.position.numQuantizationBits=d.quantization_bits(),m.attributes.position.minValues=new Float32Array(3),h=0;3>h;++h)m.attributes.position.minValues[h]=d.min_value(h);a.destroy(d);a.destroy(b);a.destroy(f);this.decode_time=k-n;this.import_time=performance.now()-k;0<this.verbosity&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time));return m},isVersionSupported:function(a,b){THREE.DRACOLoader.getDecoderModule().then(function(d){b(d.decoder.isVersionSupported(a))})},getAttributeOptions:function(a){"undefined"===typeof this.attributeOptions[a]&&(this.attributeOptions[a]={});return this.attributeOptions[a]}};THREE.DRACOLoader.decoderPath="./";THREE.DRACOLoader.decoderConfig={};THREE.DRACOLoader.decoderModulePromise=null;THREE.DRACOLoader.setDecoderPath=function(a){THREE.DRACOLoader.decoderPath=a};THREE.DRACOLoader.setDecoderConfig=function(a){var b=THREE.DRACOLoader.decoderConfig.wasmBinary;THREE.DRACOLoader.decoderConfig=a||{};THREE.DRACOLoader.releaseDecoderModule();b&&(THREE.DRACOLoader.decoderConfig.wasmBinary=b)};THREE.DRACOLoader.releaseDecoderModule=function(){THREE.DRACOLoader.decoderModulePromise=null};THREE.DRACOLoader.getDecoderModule=function(){var a=this,b=THREE.DRACOLoader.decoderPath,d=THREE.DRACOLoader.decoderConfig,c=THREE.DRACOLoader.decoderModulePromise;if(c)return c;"undefined"!==typeof DracoDecoderModule?c=Promise.resolve():"object"!==typeof WebAssembly||"js"===d.type?c=THREE.DRACOLoader._loadScript(b+"draco_decoder.js"):(d.wasmBinaryFile=b+"draco_decoder.wasm",c=THREE.DRACOLoader._loadScript(b+"draco_wasm_wrapper.js").then(function(){return THREE.DRACOLoader._loadArrayBuffer(d.wasmBinaryFile)}).then(function(a){d.wasmBinary=a}));c=c.then(function(){return new Promise(function(b){d.onModuleLoaded=function(c){a.timeLoaded=performance.now();b({decoder:c})};DracoDecoderModule(d)})});return THREE.DRACOLoader.decoderModulePromise=c};THREE.DRACOLoader._loadScript=function(a){var b=document.getElementById("decoder_script");null!==b&&b.parentNode.removeChild(b);var d=document.getElementsByTagName("head")[0],c=document.createElement("script");c.id="decoder_script";c.type="text/javascript";c.src=a;return new Promise(function(a){c.onload=a;d.appendChild(c)})};THREE.DRACOLoader._loadArrayBuffer=function(a){var b=new THREE.FileLoader;b.setResponseType("arraybuffer");return new Promise(function(d,c){b.load(a,d,void 0,c)})};

var TWEEN=TWEEN||function(){var a=[];return{REVISION:"7",getAll:function(){return a},removeAll:function(){a=[]},add:function(c){a.push(c)},remove:function(c){c=a.indexOf(c);-1!==c&&a.splice(c,1)},update:function(c){if(0===a.length)return!1;var f=0,g=a.length;for(c=void 0!==c?c:Date.now();f<g;)a[f].update(c)?f++:(a.splice(f,1),g--);return!0}}}();TWEEN.Tween=function(a){var c={},f={},g=1E3,l=0,p=null,d=TWEEN.Easing.Linear.None,w=TWEEN.Interpolation.Linear,e=[],m=null,A=!1,C=null,B=null;this.to=function(a,b){null!==b&&(g=b);f=a;return this};this.start=function(e){TWEEN.add(this);A=!1;p=void 0!==e?e:Date.now();p+=l;for(var b in f)if(null!==a[b]){if(f[b]instanceof Array){if(0===f[b].length)continue;f[b]=[a[b]].concat(f[b])}c[b]=a[b]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(a){l=a;return this};this.easing=function(a){d=a;return this};this.interpolation=function(a){w=a;return this};this.chain=function(){e=arguments;return this};this.onStart=function(a){m=a;return this};this.onUpdate=function(a){C=a;return this};this.onComplete=function(a){B=a;return this};this.update=function(l){if(l<p)return!0;!1===A&&(null!==m&&m.call(a),A=!0);var b=(l-p)/g,b=1<b?1:b,r=d(b),v;for(v in c){var y=c[v],q=f[v];a[v]=q instanceof Array?w(q,r):y+(q-y)*r}null!==C&&C.call(a,r);if(1==b){null!==B&&B.call(a);b=0;for(r=e.length;b<r;b++)e[b].start(l);return!1}return!0}};TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var c,f=.1;if(0===a)return 0;if(1===a)return 1;!f||1>f?(f=1,c=.1):c=.4*Math.asin(1/f)/(2*Math.PI);return-(f*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4))},Out:function(a){var c,f=.1;if(0===a)return 0;if(1===a)return 1;!f||1>f?(f=1,c=.1):c=.4*Math.asin(1/f)/(2*Math.PI);return f*Math.pow(2,-10*a)*Math.sin(2*(a-c)*Math.PI/.4)+1},InOut:function(a){var c,f=.1;if(0===a)return 0;if(1===a)return 1;!f||1>f?(f=1,c=.1):c=.4*Math.asin(1/f)/(2*Math.PI);return 1>(a*=2)?-.5*f*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4):.5*f*Math.pow(2,-10*--a)*Math.sin(2*(a-c)*Math.PI/.4)+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*a-1)+.5}}};TWEEN.Interpolation={Linear:function(a,c){var f=a.length-1,g=f*c,l=Math.floor(g),p=TWEEN.Interpolation.Utils.Linear;return 0>c?p(a[0],a[1],g):1<c?p(a[f],a[f-1],f-g):p(a[l],a[l+1>f?f:l+1],g-l)},Bezier:function(a,c){var f=0,g=a.length-1,l=Math.pow,p=TWEEN.Interpolation.Utils.Bernstein,d;for(d=0;d<=g;d++)f+=l(1-c,g-d)*l(c,d)*a[d]*p(g,d);return f},CatmullRom:function(a,c){var f=a.length-1,g=f*c,l=Math.floor(g),p=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[f]?(0>c&&(l=Math.floor(g=f*(1+c))),p(a[(l-1+f)%f],a[l],a[(l+1)%f],a[(l+2)%f],g-l)):0>c?a[0]-(p(a[0],a[0],a[1],a[1],-g)-a[0]):1<c?a[f]-(p(a[f],a[f],a[f-1],a[f-1],g-f)-a[f]):p(a[l?l-1:0],a[l],a[f<l+1?f:l+1],a[f<l+2?f:l+2],g-l)},Utils:{Linear:function(a,c,f){return(c-a)*f+a},Bernstein:function(a,c){var f=TWEEN.Interpolation.Utils.Factorial;return f(a)/f(c)/f(a-c)},Factorial:function(){var a=[1];return function(c){var f=1,g;if(a[c])return a[c];for(g=c;1<g;g--)f*=g;return a[c]=f}}(),CatmullRom:function(a,c,f,g,l){a=.5*(f-a);g=.5*(g-c);var p=l*l;return(2*c-2*f+a+g)*l*p+(-3*c+3*f-2*a-g)*p+a*l+c}}};var Stats=function(){function a(a){g.appendChild(a.dom);return a}function c(a){for(var e=0;e<g.children.length;e++)g.children[e].style.display=e===a?"block":"none";f=a}var f=0,g=document.createElement("div");g.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";g.addEventListener("click",function(a){a.preventDefault();c(++f%g.children.length)},!1);var l=(performance||Date).now(),p=l,d=0,w=a(new Stats.Panel("FPS","#0ff","#002")),e=a(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var m=a(new Stats.Panel("MB","#f08","#201"));c(0);return{REVISION:16,dom:g,addPanel:a,showPanel:c,begin:function(){l=(performance||Date).now()},end:function(){d++;var a=(performance||Date).now();e.update(a-l,200);if(a>p+1E3&&(w.update(1E3*d/(a-p),100),p=a,d=0,m)){var c=performance.memory;m.update(c.usedJSHeapSize/1048576,c.jsHeapSizeLimit/1048576)}return a},update:function(){l=this.end()},domElement:g,setMode:c}};Stats.Panel=function(a,c,f){var g=Infinity,l=0,p=Math.round,d=p(window.devicePixelRatio||1),w=80*d,e=48*d,m=3*d,A=2*d,C=3*d,B=15*d,x=74*d,b=30*d,r=document.createElement("canvas");r.width=w;r.height=e;r.style.cssText="width:80px;height:48px";var v=r.getContext("2d");v.font="bold "+9*d+"px Helvetica,Arial,sans-serif";v.textBaseline="top";v.fillStyle=f;v.fillRect(0,0,w,e);v.fillStyle=c;v.fillText(a,m,A);v.fillRect(C,B,x,b);v.fillStyle=f;v.globalAlpha=.9;v.fillRect(C,B,x,b);return{dom:r,update:function(e,q){g=Math.min(g,e);l=Math.max(l,e);v.fillStyle=f;v.globalAlpha=1;v.fillRect(0,0,w,B);v.fillStyle=c;v.fillText(p(e)+" "+a+" ("+p(g)+"-"+p(l)+")",m,A);v.drawImage(r,C+d,B,x-d,b,C,B,x-d,b);v.fillRect(C+x-d,B,d,b);v.fillStyle=f;v.globalAlpha=.9;v.fillRect(C+x-d,B,d,p((1-e/q)*b))}}};"object"===typeof module&&(module.exports=Stats);THREE.MTLLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(a,c,f,g){var l=this,p=void 0===this.path?THREE.LoaderUtils.extractUrlBase(a):this.path,d=new THREE.FileLoader(this.manager);d.setPath(this.path);d.load(a,function(a){c(l.parse(a,p))},f,g)},setPath:function(a){this.path=a;return this},setResourcePath:function(a){this.resourcePath=a;return this},setTexturePath:function(a){console.warn("THREE.MTLLoader: .setTexturePath() has been renamed to .setResourcePath().");return this.setResourcePath(a)},setCrossOrigin:function(a){this.crossOrigin=a;return this},setMaterialOptions:function(a){this.materialOptions=a;return this},parse:function(a,c){var f=a.split("\n"),g={},l=/\s+/;a={};for(var p=0;p<f.length;p++){var d=f[p],d=d.trim();if(0!==d.length&&"#"!==d.charAt(0)){var w=d.indexOf(" "),e=0<=w?d.substring(0,w):d,e=e.toLowerCase(),d=0<=w?d.substring(w+1):"",d=d.trim();"newmtl"===e?(g={name:d},a[d]=g):"ka"===e||"kd"===e||"ks"===e||"ke"===e?(d=d.split(l,3),g[e]=[parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]):g[e]=d}}c=new THREE.MTLLoader.MaterialCreator(this.resourcePath||c,this.materialOptions);c.setCrossOrigin(this.crossOrigin);c.setManager(this.manager);c.setMaterials(a);return c}};THREE.MTLLoader.MaterialCreator=function(a,c){this.baseUrl=a||"";this.options=c;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(a){this.crossOrigin=a;return this},setManager:function(a){this.manager=a},setMaterials:function(a){this.materialsInfo=this.convert(a);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(a){if(!this.options)return a;var c={},f;for(f in a){var g=a[f],l={};c[f]=l;for(var p in g){var d=!0,w=g[p],e=p.toLowerCase();switch(e){case "kd":case "ka":case "ks":this.options&&this.options.normalizeRGB&&(w=[w[0]/255,w[1]/255,w[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===w[0]&&0===w[1]&&0===w[2]&&(d=!1)}d&&(l[e]=w)}}return c},preload:function(){for(var a in this.materialsInfo)this.create(a)},getIndex:function(a){return this.nameLookup[a]},getAsArray:function(){var a=0,c;for(c in this.materialsInfo)this.materialsArray[a]=this.create(c),this.nameLookup[c]=a,a++;return this.materialsArray},create:function(a){void 0===this.materials[a]&&this.createMaterial_(a);return this.materials[a]},createMaterial_:function(a){function c(a,d){return"string"!==typeof d||""===d?"":/^https?:\/\//i.test(d)?d:a+d}function f(a,d){if(!p[a]){d=g.getTextureParams(d,p);var e=g.loadTexture(c(g.baseUrl,d.url));e.repeat.copy(d.scale);e.offset.copy(d.offset);e.wrapS=g.wrap;e.wrapT=g.wrap;p[a]=e}}var g=this,l=this.materialsInfo[a],p={name:a,side:this.side},d;for(d in l){var w=l[d];if(""!==w)switch(d.toLowerCase()){case "kd":p.color=(new THREE.Color).fromArray(w);break;case "ks":p.specular=(new THREE.Color).fromArray(w);break;case "ke":p.emissive=(new THREE.Color).fromArray(w);break;case "map_kd":f("map",w);break;case "map_ks":f("specularMap",w);break;case "map_ke":f("emissiveMap",w);break;case "norm":f("normalMap",w);break;case "map_bump":case "bump":f("bumpMap",w);break;case "map_d":f("alphaMap",w);p.transparent=!0;break;case "ns":p.shininess=parseFloat(w);break;case "d":w=parseFloat(w);1>w&&(p.opacity=w,p.transparent=!0);break;case "tr":w=parseFloat(w),this.options&&this.options.invertTrProperty&&(w=1-w),0<w&&(p.opacity=1-w,p.transparent=!0)}}this.materials[a]=new THREE.MeshPhongMaterial(p);return this.materials[a]},getTextureParams:function(a,c){var f={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)};a=a.split(/\s+/);var g;g=a.indexOf("-bm");0<=g&&(c.bumpScale=parseFloat(a[g+1]),a.splice(g,2));g=a.indexOf("-s");0<=g&&(f.scale.set(parseFloat(a[g+1]),parseFloat(a[g+2])),a.splice(g,4));g=a.indexOf("-o");0<=g&&(f.offset.set(parseFloat(a[g+1]),parseFloat(a[g+2])),a.splice(g,4));f.url=a.join(" ").trim();return f},loadTexture:function(a,c,f,g,l){var p=THREE.Loader.Handlers.get(a),d=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;null===p&&(p=new THREE.TextureLoader(d));p.setCrossOrigin&&p.setCrossOrigin(this.crossOrigin);a=p.load(a,f,g,l);void 0!==c&&(a.mapping=c);return a}};THREE.OBJLoader=function(){function a(){var a={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(a,c){if(this.object&&!1===this.object.fromDeclaration)this.object.name=a,this.object.fromDeclaration=!1!==c;else{var e=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0);this.object={name:a||"",fromDeclaration:!1!==c,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(a,e){var d=this._finalize(!1);d&&(d.inherited||0>=d.groupCount)&&this.materials.splice(d.index,1);a={index:this.materials.length,name:a||"",mtllib:Array.isArray(e)&&0<e.length?e[e.length-1]:"",smooth:void 0!==d?d.smooth:this.smooth,groupStart:void 0!==d?d.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){a={index:"number"===typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};a.clone=this.clone.bind(a);return a}};this.materials.push(a);return a},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(a){var e=this.currentMaterial();e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1);if(a&&1<this.materials.length)for(var d=this.materials.length-1;0<=d;d--)0>=this.materials[d].groupCount&&this.materials.splice(d,1);a&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth});return e}};e&&e.name&&"function"===typeof e.clone&&(a=e.clone(0),a.inherited=!0,this.object.materials.push(a));this.objects.push(this.object)}},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(a,c){a=parseInt(a,10);return 3*(0<=a?a-1:a+c/3)},parseNormalIndex:function(a,c){a=parseInt(a,10);return 3*(0<=a?a-1:a+c/3)},parseUVIndex:function(a,c){a=parseInt(a,10);return 2*(0<=a?a-1:a+c/2)},addVertex:function(a,c,e){var d=this.vertices,f=this.object.geometry.vertices;f.push(d[a+0],d[a+1],d[a+2]);f.push(d[c+0],d[c+1],d[c+2]);f.push(d[e+0],d[e+1],d[e+2])},addVertexPoint:function(a){var d=this.vertices;this.object.geometry.vertices.push(d[a+0],d[a+1],d[a+2])},addVertexLine:function(a){var d=this.vertices;this.object.geometry.vertices.push(d[a+0],d[a+1],d[a+2])},addNormal:function(a,c,e){var d=this.normals,f=this.object.geometry.normals;f.push(d[a+0],d[a+1],d[a+2]);f.push(d[c+0],d[c+1],d[c+2]);f.push(d[e+0],d[e+1],d[e+2])},addColor:function(a,c,e){var d=this.colors,f=this.object.geometry.colors;f.push(d[a+0],d[a+1],d[a+2]);f.push(d[c+0],d[c+1],d[c+2]);f.push(d[e+0],d[e+1],d[e+2])},addUV:function(a,c,e){var d=this.uvs,f=this.object.geometry.uvs;f.push(d[a+0],d[a+1]);f.push(d[c+0],d[c+1]);f.push(d[e+0],d[e+1])},addUVLine:function(a){var d=this.uvs;this.object.geometry.uvs.push(d[a+0],d[a+1])},addFace:function(a,c,e,f,g,p,l,x,b){var d=this.vertices.length;a=this.parseVertexIndex(a,d);c=this.parseVertexIndex(c,d);e=this.parseVertexIndex(e,d);this.addVertex(a,c,e);void 0!==f&&""!==f&&(e=this.uvs.length,a=this.parseUVIndex(f,e),c=this.parseUVIndex(g,e),e=this.parseUVIndex(p,e),this.addUV(a,c,e));void 0!==l&&""!==l&&(f=this.normals.length,a=this.parseNormalIndex(l,f),c=l===x?a:this.parseNormalIndex(x,f),e=l===b?a:this.parseNormalIndex(b,f),this.addNormal(a,c,e));0<this.colors.length&&this.addColor(a,c,e)},addPointGeometry:function(a){this.object.geometry.type="Points";for(var c=this.vertices.length,e=0,d=a.length;e<d;e++)this.addVertexPoint(this.parseVertexIndex(a[e],c))},addLineGeometry:function(a,c){this.object.geometry.type="Line";for(var e=this.vertices.length,d=this.uvs.length,f=0,g=a.length;f<g;f++)this.addVertexLine(this.parseVertexIndex(a[f],e));a=0;for(g=c.length;a<g;a++)this.addUVLine(this.parseUVIndex(c[a],d))}};a.startObject("",!1);return a}function c(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.materials=null}var f=/^[og]\s*(.+)?/,g=/^mtllib /,l=/^usemtl /;c.prototype={constructor:c,load:function(a,c,f,e){var d=this,g=new THREE.FileLoader(d.manager);g.setPath(this.path);g.load(a,function(a){c(d.parse(a))},f,e)},setPath:function(a){this.path=a;return this},setMaterials:function(a){this.materials=a;return this},parse:function(c){console.time("OBJLoader");var d=new a;-1!==c.indexOf("\r\n")&&(c=c.replace(/\r\n/g,"\n"));-1!==c.indexOf("\\\n")&&(c=c.replace(/\\\n/g,""));var p=c.split("\n"),e,m,A,C="function"===typeof"".trimLeft;c=0;for(var B=p.length;c<B;c++)if(e=p[c],e=C?e.trimLeft():e.trim(),m=e.length,0!==m&&(m=e.charAt(0),"#"!==m))if("v"===m)switch(e=e.split(/\s+/),e[0]){case "v":d.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));8===e.length&&d.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6]));break;case "vn":d.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case "vt":d.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}else if("f"===m){e=e.substr(1).trim();var x=e.split(/\s+/);e=[];m=0;for(A=x.length;m<A;m++){var b=x[m];0<b.length&&(b=b.split("/"),e.push(b))}x=e[0];m=1;for(A=e.length-1;m<A;m++){var b=e[m],r=e[m+1];d.addFace(x[0],b[0],r[0],x[1],b[1],r[1],x[2],b[2],r[2])}}else if("l"===m){m=e.substring(1).trim().split(" ");A=[];x=[];if(-1===e.indexOf("/"))A=m;else for(e=0,b=m.length;e<b;e++)r=m[e].split("/"),""!==r[0]&&A.push(r[0]),""!==r[1]&&x.push(r[1]);d.addLineGeometry(A,x)}else if("p"===m)e=e.substr(1).trim(),e=e.split(" "),d.addPointGeometry(e);else if(null!==(A=f.exec(e)))e=(" "+A[0].substr(1).trim()).substr(1),d.startObject(e);else if(l.test(e))d.object.startMaterial(e.substring(7).trim(),d.materialLibraries);else if(g.test(e))d.materialLibraries.push(e.substring(7).trim());else if("s"===m){if(A=e.split(" "),1<A.length?(e=A[1].trim().toLowerCase(),d.object.smooth="0"!==e&&"off"!==e):d.object.smooth=!0,e=d.object.currentMaterial())e.smooth=d.object.smooth}else if("\x00"!==e)throw Error('THREE.OBJLoader: Unexpected line: "'+e+'"');d.finalize();p=new THREE.Group;p.materialLibraries=[].concat(d.materialLibraries);c=0;for(B=d.objects.length;c<B;c++)if(C=d.objects[c],e=C.geometry,m=C.materials,A="Line"===e.type,x="Points"===e.type,b=!1,0!==e.vertices.length){r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3));0<e.normals.length?r.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)):r.computeVertexNormals();0<e.colors.length&&(b=!0,r.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)));0<e.uvs.length&&r.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2));for(var v=[],y=0,q=m.length;y<q;y++){var h=m[y];e=void 0;if(null!==this.materials)if(e=this.materials.create(h.name),!A||!e||e instanceof THREE.LineBasicMaterial)!x||!e||e instanceof THREE.PointsMaterial||(D=new THREE.PointsMaterial({size:10,sizeAttenuation:!1}),THREE.Material.prototype.copy.call(D,e),D.color.copy(e.color),D.map=e.map,D.lights=!1,e=D);else{var D=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(D,e);D.color.copy(e.color);D.lights=!1;e=D}e||(e=A?new THREE.LineBasicMaterial:x?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial,e.name=h.name);e.flatShading=h.smooth?!1:!0;e.vertexColors=b?THREE.VertexColors:THREE.NoColors;v.push(e)}if(1<v.length){y=0;for(q=m.length;y<q;y++)h=m[y],r.addGroup(h.groupStart,h.groupCount,y);e=A?new THREE.LineSegments(r,v):x?new THREE.Points(r,v):new THREE.Mesh(r,v)}else e=A?new THREE.LineSegments(r,v[0]):x?new THREE.Points(r,v[0]):new THREE.Mesh(r,v[0]);e.name=C.name;p.add(e)}console.timeEnd("OBJLoader");return p}};return c}();THREE.OrbitControls=function(a,c){function f(){return Math.pow(.95,b.zoomSpeed)}function g(a){b.object.isPerspectiveCamera?H/=a:b.object.isOrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom*a)),b.object.updateProjectionMatrix(),F=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function l(a){b.object.isPerspectiveCamera?H*=a:b.object.isOrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom/a)),b.object.updateProjectionMatrix(),F=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function p(a){if(!1!==b.enabled){a.preventDefault();b.domElement.focus?b.domElement.focus():window.focus();switch(a.button){case b.mouseButtons.LEFT:if(a.ctrlKey||a.metaKey||a.shiftKey){if(!1===b.enablePan)return;N.set(a.clientX,a.clientY);h=q.PAN}else{if(!1===b.enableRotate)return;J.set(a.clientX,a.clientY);h=q.ROTATE}break;case b.mouseButtons.MIDDLE:if(!1===b.enableZoom)return;k.set(a.clientX,a.clientY);h=q.DOLLY;break;case b.mouseButtons.RIGHT:if(!1===b.enablePan)return;N.set(a.clientX,a.clientY);h=q.PAN}h!==q.NONE&&(document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",w,!1),b.dispatchEvent(v))}}function d(a){if(!1!==b.enabled)switch(a.preventDefault(),h){case q.ROTATE:if(!1===b.enableRotate)break;L.set(a.clientX,a.clientY);I.subVectors(L,J).multiplyScalar(b.rotateSpeed);a=b.domElement===document?b.domElement.body:b.domElement;z.theta-=2*Math.PI*I.x/a.clientHeight;z.phi-=2*Math.PI*I.y/a.clientHeight;J.copy(L);b.update();break;case q.DOLLY:if(!1===b.enableZoom)break;n.set(a.clientX,a.clientY);t.subVectors(n,k);0<t.y?g(f()):0>t.y&&l(f());k.copy(n);b.update();break;case q.PAN:!1!==b.enablePan&&(M.set(a.clientX,a.clientY),O.subVectors(M,N).multiplyScalar(b.panSpeed),E(O.x,O.y),N.copy(M),b.update())}}function w(a){!1!==b.enabled&&(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",w,!1),b.dispatchEvent(y),h=q.NONE)}function e(a){!1===b.enabled||!1===b.enableZoom||h!==q.NONE&&h!==q.ROTATE||(a.preventDefault(),a.stopPropagation(),b.dispatchEvent(v),0>a.deltaY?l(f()):0<a.deltaY&&g(f()),b.update(),b.dispatchEvent(y))}function m(a){if(!1!==b.enabled&&!1!==b.enableKeys&&!1!==b.enablePan){var n=!1;switch(a.keyCode){case b.keys.UP:E(0,b.keyPanSpeed);n=!0;break;case b.keys.BOTTOM:E(0,-b.keyPanSpeed);n=!0;break;case b.keys.LEFT:E(b.keyPanSpeed,0);n=!0;break;case b.keys.RIGHT:E(-b.keyPanSpeed,0),n=!0}n&&(a.preventDefault(),b.update())}}function A(a){if(!1!==b.enabled){a.preventDefault();switch(a.touches.length){case 1:if(!1===b.enableRotate)return;J.set(a.touches[0].pageX,a.touches[0].pageY);h=q.TOUCH_ROTATE;break;case 2:if(!1===b.enableZoom&&!1===b.enablePan)return;if(b.enableZoom){var n=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;k.set(0,Math.sqrt(n*n+c*c))}b.enablePan&&N.set(.5*(a.touches[0].pageX+a.touches[1].pageX),.5*(a.touches[0].pageY+a.touches[1].pageY));h=q.TOUCH_DOLLY_PAN;break;default:h=q.NONE}h!==q.NONE&&b.dispatchEvent(v)}}function C(a){if(!1!==b.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===b.enableRotate)break;if(h!==q.TOUCH_ROTATE)break;L.set(a.touches[0].pageX,a.touches[0].pageY);I.subVectors(L,J).multiplyScalar(b.rotateSpeed);a=b.domElement===document?b.domElement.body:b.domElement;z.theta-=2*Math.PI*I.x/a.clientHeight;z.phi-=2*Math.PI*I.y/a.clientHeight;J.copy(L);b.update();break;case 2:if(!1===b.enableZoom&&!1===b.enablePan)break;if(h!==q.TOUCH_DOLLY_PAN)break;if(b.enableZoom){var c=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;n.set(0,Math.sqrt(c*c+e*e));t.set(0,Math.pow(n.y/k.y,b.zoomSpeed));g(t.y);k.copy(n)}b.enablePan&&(M.set(.5*(a.touches[0].pageX+a.touches[1].pageX),.5*(a.touches[0].pageY+a.touches[1].pageY)),O.subVectors(M,N).multiplyScalar(b.panSpeed),E(O.x,O.y),N.copy(M));b.update();break;default:h=q.NONE}}function B(a){!1!==b.enabled&&(b.dispatchEvent(y),h=q.NONE)}function x(a){!1!==b.enabled&&a.preventDefault()}this.object=a;this.domElement=void 0!==c?c:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.panSpeed=1;this.screenSpacePanning=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return u.phi};this.getAzimuthalAngle=function(){return u.theta};this.saveState=function(){b.target0.copy(b.target);b.position0.copy(b.object.position);b.zoom0=b.object.zoom};this.reset=function(){b.target.copy(b.target0);b.object.position.copy(b.position0);b.object.zoom=b.zoom0;b.object.updateProjectionMatrix();b.dispatchEvent(r);b.update();h=q.NONE};this.update=function(){var n=new THREE.Vector3,k=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),c=k.clone().inverse(),t=new THREE.Vector3,e=new THREE.Quaternion;return function(){var a=b.object.position;n.copy(a).sub(b.target);n.applyQuaternion(k);u.setFromVector3(n);b.autoRotate&&h===q.NONE&&(z.theta-=2*Math.PI/60/60*b.autoRotateSpeed);u.theta+=z.theta;u.phi+=z.phi;u.theta=Math.max(b.minAzimuthAngle,Math.min(b.maxAzimuthAngle,u.theta));u.phi=Math.max(b.minPolarAngle,Math.min(b.maxPolarAngle,u.phi));u.makeSafe();u.radius*=H;u.radius=Math.max(b.minDistance,Math.min(b.maxDistance,u.radius));b.target.add(K);n.setFromSpherical(u);n.applyQuaternion(c);a.copy(b.target).add(n);b.object.lookAt(b.target);!0===b.enableDamping?(z.theta*=1-b.dampingFactor,z.phi*=1-b.dampingFactor,K.multiplyScalar(1-b.dampingFactor)):(z.set(0,0,0),K.set(0,0,0));H=1;return F||t.distanceToSquared(b.object.position)>D||8*(1-e.dot(b.object.quaternion))>D?(b.dispatchEvent(r),t.copy(b.object.position),e.copy(b.object.quaternion),F=!1,!0):!1}}();this.dispose=function(){b.domElement.removeEventListener("contextmenu",x,!1);b.domElement.removeEventListener("mousedown",p,!1);b.domElement.removeEventListener("wheel",e,!1);b.domElement.removeEventListener("touchstart",A,!1);b.domElement.removeEventListener("touchend",B,!1);b.domElement.removeEventListener("touchmove",C,!1);document.removeEventListener("mousemove",d,!1);document.removeEventListener("mouseup",w,!1);window.removeEventListener("keydown",m,!1)};var b=this,r={type:"change"},v={type:"start"},y={type:"end"},q={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},h=q.NONE,D=1E-6,u=new THREE.Spherical,z=new THREE.Spherical,H=1,K=new THREE.Vector3,F=!1,J=new THREE.Vector2,L=new THREE.Vector2,I=new THREE.Vector2,N=new THREE.Vector2,M=new THREE.Vector2,O=new THREE.Vector2,k=new THREE.Vector2,n=new THREE.Vector2,t=new THREE.Vector2,G=function(){var a=new THREE.Vector3;return function(b,n){a.setFromMatrixColumn(n,0);a.multiplyScalar(-b);K.add(a)}}(),P=function(){var a=new THREE.Vector3;return function(n,k){!0===b.screenSpacePanning?a.setFromMatrixColumn(k,1):(a.setFromMatrixColumn(k,0),a.crossVectors(b.object.up,a));a.multiplyScalar(n);K.add(a)}}(),E=function(){var a=new THREE.Vector3;return function(n,k){var c=b.domElement===document?b.domElement.body:b.domElement;if(b.object.isPerspectiveCamera){a.copy(b.object.position).sub(b.target);var t=a.length(),t=t*Math.tan(b.object.fov/2*Math.PI/180);G(2*n*t/c.clientHeight,b.object.matrix);P(2*k*t/c.clientHeight,b.object.matrix)}else b.object.isOrthographicCamera?(G(n*(b.object.right-b.object.left)/b.object.zoom/c.clientWidth,b.object.matrix),P(k*(b.object.top-b.object.bottom)/b.object.zoom/c.clientHeight,b.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),b.enablePan=!1)}}();b.domElement.addEventListener("contextmenu",x,!1);b.domElement.addEventListener("mousedown",p,!1);b.domElement.addEventListener("wheel",e,!1);b.domElement.addEventListener("touchstart",A,!1);b.domElement.addEventListener("touchend",B,!1);b.domElement.addEventListener("touchmove",C,!1);window.addEventListener("keydown",m,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){console.warn("THREE.OrbitControls: .center has been renamed to .target");return this.target}},noZoom:{get:function(){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!a}},noRotate:{get:function(){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!a}},noPan:{get:function(){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!a}},noKeys:{get:function(){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!a}},staticMoving:{get:function(){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.enableDamping=!a}},dynamicDampingFactor:{get:function(){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.dampingFactor=a}}});THREE.Lensflare=function(){THREE.Mesh.call(this,THREE.Lensflare.Geometry,new THREE.MeshBasicMaterial({opacity:0,transparent:!0}));this.type="Lensflare";this.frustumCulled=!1;this.renderOrder=Infinity;var a=new THREE.Vector3,c=new THREE.Vector3,f=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);f.minFilter=THREE.NearestFilter;f.magFilter=THREE.NearestFilter;f.wrapS=THREE.ClampToEdgeWrapping;f.wrapT=THREE.ClampToEdgeWrapping;f.needsUpdate=!0;var g=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);g.minFilter=THREE.NearestFilter;g.magFilter=THREE.NearestFilter;g.wrapS=THREE.ClampToEdgeWrapping;g.wrapT=THREE.ClampToEdgeWrapping;g.needsUpdate=!0;var l=THREE.Lensflare.Geometry,p=new THREE.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"precision highp float;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nattribute vec3 position;\nvoid main() {\n\tgl_Position \x3d vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision highp float;\nvoid main() {\n\tgl_FragColor \x3d vec4( 1.0, 0.0, 1.0, 1.0 );\n}",depthTest:!0,depthWrite:!1,transparent:!1}),d=new THREE.RawShaderMaterial({uniforms:{map:{value:f},scale:{value:null},screenPosition:{value:null}},vertexShader:"precision highp float;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\n\tvUV \x3d uv;\n\tgl_Position \x3d vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision highp float;\nuniform sampler2D map;\nvarying vec2 vUV;\nvoid main() {\n\tgl_FragColor \x3d texture2D( map, vUV );\n}",depthTest:!1,depthWrite:!1,transparent:!1}),w=new THREE.Mesh(l,p),e=[],m=THREE.LensflareElement.Shader,A=new THREE.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:g},color:{value:new THREE.Color(16777215)},scale:{value:new THREE.Vector2},screenPosition:{value:new THREE.Vector3}},vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1}),C=new THREE.Mesh(l,A);this.addElement=function(a){e.push(a)};var B=new THREE.Vector2,x=new THREE.Vector2,b=new THREE.Box2,r=new THREE.Vector4;this.onBeforeRender=function(v,m,q){v.getCurrentViewport(r);m=r.w/r.z;var h=r.z/2,y=r.w/2,u=16/r.w;B.set(u*m,u);b.min.set(r.x,r.y);b.max.set(r.x+(r.z-16),r.y+(r.w-16));c.setFromMatrixPosition(this.matrixWorld);c.applyMatrix4(q.matrixWorldInverse);if(!(0<c.z)&&(a.copy(c).applyMatrix4(q.projectionMatrix),x.x=r.x+a.x*h+h-8,x.y=r.y+a.y*y+y-8,b.containsPoint(x))){v.copyFramebufferToTexture(x,f);h=p.uniforms;h.scale.value=B;h.screenPosition.value=a;v.renderBufferDirect(q,null,l,p,w,null);v.copyFramebufferToTexture(x,g);h=d.uniforms;h.scale.value=B;h.screenPosition.value=a;v.renderBufferDirect(q,null,l,d,w,null);for(var y=2*-a.x,z=2*-a.y,H=0,K=e.length;H<K;H++)m=e[H],h=A.uniforms,h.color.value.copy(m.color),h.map.value=m.texture,h.screenPosition.value.x=a.x+y*m.distance,h.screenPosition.value.y=a.y+z*m.distance,u=m.size/r.w,m=r.w/r.z,h.scale.value.set(u*m,u),A.uniformsNeedUpdate=!0,v.renderBufferDirect(q,null,l,A,C,null)}};this.dispose=function(){p.dispose();d.dispose();A.dispose();f.dispose();g.dispose();for(var a=0,b=e.length;a<b;a++)e[a].texture.dispose()}};THREE.Lensflare.prototype=Object.create(THREE.Mesh.prototype);THREE.Lensflare.prototype.constructor=THREE.Lensflare;THREE.Lensflare.prototype.isLensflare=!0;THREE.LensflareElement=function(a,c,f,g){this.texture=a;this.size=c||1;this.distance=f||0;this.color=g||new THREE.Color(16777215)};THREE.LensflareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"precision highp float;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform sampler2D occlusionMap;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\n\tvUV \x3d uv;\n\tvec2 pos \x3d position.xy;\n\tvec4 visibility \x3d texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n\tvisibility +\x3d texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n\tvVisibility \x3d        visibility.r / 9.0;\n\tvVisibility *\x3d 1.0 - visibility.g / 9.0;\n\tvVisibility *\x3d       visibility.b / 9.0;\n\tgl_Position \x3d vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision highp float;\nuniform sampler2D map;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\n\tvec4 texture \x3d texture2D( map, vUV );\n\ttexture.a *\x3d vVisibility;\n\tgl_FragColor \x3d texture;\n\tgl_FragColor.rgb *\x3d color;\n}"};THREE.Lensflare.Geometry=function(){var a=new THREE.BufferGeometry,c=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),c=new THREE.InterleavedBuffer(c,5);a.setIndex([0,1,2,0,2,3]);a.addAttribute("position",new THREE.InterleavedBufferAttribute(c,3,0,!1));a.addAttribute("uv",new THREE.InterleavedBufferAttribute(c,2,3,!1));return a}();THREE.Reflector=function(a,c){THREE.Mesh.call(this,a);this.type="Reflector";var f=this;c=c||{};a=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);var g=c.textureWidth||512,l=c.textureHeight||512,p=c.clipBias||0,d=c.shader||THREE.Reflector.ReflectorShader,w=void 0!==c.recursion?c.recursion:0,e=new THREE.Plane,m=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Vector3,B=new THREE.Matrix4,x=new THREE.Vector3(0,0,-1),b=new THREE.Vector4,r=new THREE.Vector4,v=new THREE.Vector3,y=new THREE.Vector3,q=new THREE.Vector4,h=new THREE.Vector2,D=new THREE.Matrix4,u=new THREE.PerspectiveCamera,z=new THREE.WebGLRenderTarget(g,l,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1});THREE.Math.isPowerOfTwo(g)&&THREE.Math.isPowerOfTwo(l)||(z.texture.generateMipmaps=!1);c=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(d.uniforms),fragmentShader:d.fragmentShader,vertexShader:d.vertexShader});c.uniforms.tDiffuse.value=z.texture;c.uniforms.color.value=a;c.uniforms.textureMatrix.value=D;this.material=c;this.onBeforeRender=function(a,c,d){if("recursion"in d.userData){if(d.userData.recursion===w)return;d.userData.recursion++}A.setFromMatrixPosition(f.matrixWorld);C.setFromMatrixPosition(d.matrixWorld);B.extractRotation(f.matrixWorld);m.set(0,0,1);m.applyMatrix4(B);v.subVectors(A,C);if(!(0<v.dot(m))){v.reflect(m).negate();v.add(A);B.extractRotation(d.matrixWorld);x.set(0,0,-1);x.applyMatrix4(B);x.add(C);y.subVectors(A,x);y.reflect(m).negate();y.add(A);u.position.copy(v);u.up.set(0,1,0);u.up.applyMatrix4(B);u.up.reflect(m);u.lookAt(y);u.far=d.far;u.updateMatrixWorld();u.projectionMatrix.copy(d.projectionMatrix);u.userData.recursion=0;D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);D.multiply(u.projectionMatrix);D.multiply(u.matrixWorldInverse);D.multiply(f.matrixWorld);e.setFromNormalAndCoplanarPoint(m,A);e.applyMatrix4(u.matrixWorldInverse);b.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var g=u.projectionMatrix;q.x=(Math.sign(b.x)+g.elements[8])/g.elements[0];q.y=(Math.sign(b.y)+g.elements[9])/g.elements[5];q.z=-1;q.w=(1+g.elements[10])/g.elements[14];b.multiplyScalar(2/b.dot(q));g.elements[2]=b.x;g.elements[6]=b.y;g.elements[10]=b.z+1-p;g.elements[14]=b.w;f.visible=!1;var g=a.getRenderTarget(),l=a.vr.enabled,I=a.shadowMap.autoUpdate;a.vr.enabled=!1;a.shadowMap.autoUpdate=!1;a.setRenderTarget(z);a.clear();a.render(c,u);a.vr.enabled=l;a.shadowMap.autoUpdate=I;a.setRenderTarget(g);c=d.bounds;void 0!==c&&(a.getSize(h),d=a.getPixelRatio(),r.x=c.x*h.width*d,r.y=c.y*h.height*d,r.z=c.z*h.width*d,r.w=c.w*h.height*d,a.state.viewport(r));f.visible=!0}};this.getRenderTarget=function(){return z}};THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype);THREE.Reflector.prototype.constructor=THREE.Reflector;THREE.Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:"uniform mat4 textureMatrix;\nvarying vec4 vUv;\nvoid main() {\n\tvUv \x3d textureMatrix * vec4( position, 1.0 );\n\tgl_Position \x3d projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec4 vUv;\nfloat blendOverlay( float base, float blend ) {\n\treturn( base \x3c 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n}\nvec3 blendOverlay( vec3 base, vec3 blend ) {\n\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n}\nvoid main() {\n\tvec4 base \x3d texture2DProj( tDiffuse, vUv );\n\tgl_FragColor \x3d vec4( blendOverlay( base.rgb, color ), 1.0 );\n}"};THREE.Water=function(a,c){THREE.Mesh.call(this,a);var f=this;c=c||{};var g=void 0!==c.textureWidth?c.textureWidth:512,l=void 0!==c.textureHeight?c.textureHeight:512,p=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.alpha?c.alpha:1;var d=void 0!==c.time?c.time:0,w=void 0!==c.waterNormals?c.waterNormals:null,e=void 0!==c.sunDirection?c.sunDirection:new THREE.Vector3(.70707,.70707,0),m=new THREE.Color(void 0!==c.sunColor?c.sunColor:16777215),A=new THREE.Color(void 0!==c.waterColor?c.waterColor:8355711),C=void 0!==c.eye?c.eye:new THREE.Vector3(0,0,0),B=void 0!==c.distortionScale?c.distortionScale:20,x=void 0!==c.side?c.side:THREE.FrontSide;c=void 0!==c.fog?c.fog:!1;var b=new THREE.Plane,r=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,q=new THREE.Matrix4,h=new THREE.Vector3(0,0,-1),D=new THREE.Vector4,u=new THREE.Vector3,z=new THREE.Vector3,H=new THREE.Vector4,K=new THREE.Matrix4,F=new THREE.PerspectiveCamera,J=new THREE.WebGLRenderTarget(g,l,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1});THREE.Math.isPowerOfTwo(g)&&THREE.Math.isPowerOfTwo(l)||(J.texture.generateMipmaps=!1);var g=THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new THREE.Matrix4},sunColor:{value:new THREE.Color(8355711)},sunDirection:{value:new THREE.Vector3(.70707,.70707,0)},eye:{value:new THREE.Vector3},waterColor:{value:new THREE.Color(5592405)}}]),l=["uniform mat4 textureMatrix;\nuniform float time;\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;",THREE.ShaderChunk.fog_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\n\tmirrorCoord \x3d modelMatrix * vec4( position, 1.0 );\n\tworldPosition \x3d mirrorCoord.xyzw;\n\tmirrorCoord \x3d textureMatrix * mirrorCoord;\n\tvec4 mvPosition \x3d  modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position \x3d projectionMatrix * mvPosition;",THREE.ShaderChunk.fog_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),L=["uniform sampler2D mirrorSampler;\nuniform float alpha;\nuniform float time;\nuniform float size;\nuniform float distortionScale;\nuniform sampler2D normalSampler;\nuniform vec3 sunColor;\nuniform vec3 sunDirection;\nuniform vec3 eye;\nuniform vec3 waterColor;\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\nvec4 getNoise( vec2 uv ) {\n\tvec2 uv0 \x3d ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n\tvec2 uv1 \x3d uv / 107.0-vec2( time / -19.0, time / 31.0 );\n\tvec2 uv2 \x3d uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n\tvec2 uv3 \x3d uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n\tvec4 noise \x3d texture2D( normalSampler, uv0 ) +\n\t\ttexture2D( normalSampler, uv1 ) +\n\t\ttexture2D( normalSampler, uv2 ) +\n\t\ttexture2D( normalSampler, uv3 );\n\treturn noise * 0.5 - 1.0;\n}\nvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n\tvec3 reflection \x3d normalize( reflect( -sunDirection, surfaceNormal ) );\n\tfloat direction \x3d max( 0.0, dot( eyeDirection, reflection ) );\n\tspecularColor +\x3d pow( direction, shiny ) * sunColor * spec;\n\tdiffuseColor +\x3d max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n}",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,"void main() {\n\tvec4 noise \x3d getNoise( worldPosition.xz * size );\n\tvec3 surfaceNormal \x3d normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\tvec3 diffuseLight \x3d vec3(0.0);\n\tvec3 specularLight \x3d vec3(0.0);\n\tvec3 worldToEye \x3d eye-worldPosition.xyz;\n\tvec3 eyeDirection \x3d normalize( worldToEye );\n\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\tfloat distance \x3d length(worldToEye);\n\tvec2 distortion \x3d surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;\n\tvec3 reflectionSample \x3d vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );\n\tfloat theta \x3d max( dot( eyeDirection, surfaceNormal ), 0.0 );\n\tfloat rf0 \x3d 0.3;\n\tfloat reflectance \x3d rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n\tvec3 scatter \x3d max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n\tvec3 albedo \x3d mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\n\tvec3 outgoingLight \x3d albedo;\n\tgl_FragColor \x3d vec4( outgoingLight, alpha );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),x=new THREE.ShaderMaterial({fragmentShader:L,vertexShader:l,uniforms:THREE.UniformsUtils.clone(g),transparent:!1,lights:!0,side:x,fog:c});x.uniforms.mirrorSampler.value=J.texture;x.uniforms.textureMatrix.value=K;x.uniforms.alpha.value=a;x.uniforms.time.value=d;x.uniforms.normalSampler.value=w;x.uniforms.sunColor.value=m;x.uniforms.waterColor.value=A;x.uniforms.sunDirection.value=e;x.uniforms.distortionScale.value=B;x.uniforms.eye.value=C;f.material=x;f.onBeforeRender=function(a,c,e){v.setFromMatrixPosition(f.matrixWorld);y.setFromMatrixPosition(e.matrixWorld);q.extractRotation(f.matrixWorld);r.set(0,0,1);r.applyMatrix4(q);u.subVectors(v,y);if(!(0<u.dot(r))){u.reflect(r).negate();u.add(v);q.extractRotation(e.matrixWorld);h.set(0,0,-1);h.applyMatrix4(q);h.add(y);z.subVectors(v,h);z.reflect(r).negate();z.add(v);F.position.copy(u);F.up.set(0,1,0);F.up.applyMatrix4(q);F.up.reflect(r);F.lookAt(z);F.far=e.far;F.updateMatrixWorld();F.projectionMatrix.copy(e.projectionMatrix);K.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);K.multiply(F.projectionMatrix);K.multiply(F.matrixWorldInverse);b.setFromNormalAndCoplanarPoint(r,v);b.applyMatrix4(F.matrixWorldInverse);D.set(b.normal.x,b.normal.y,b.normal.z,b.constant);var d=F.projectionMatrix;H.x=(Math.sign(D.x)+d.elements[8])/d.elements[0];H.y=(Math.sign(D.y)+d.elements[9])/d.elements[5];H.z=-1;H.w=(1+d.elements[10])/d.elements[14];D.multiplyScalar(2/D.dot(H));d.elements[2]=D.x;d.elements[6]=D.y;d.elements[10]=D.z+1-p;d.elements[14]=D.w;C.setFromMatrixPosition(e.matrixWorld);e=a.getRenderTarget();var d=a.vr.enabled,k=a.shadowMap.autoUpdate;f.visible=!1;a.vr.enabled=!1;a.shadowMap.autoUpdate=!1;a.setRenderTarget(J);a.clear();a.render(c,F);f.visible=!0;a.vr.enabled=d;a.shadowMap.autoUpdate=k;a.setRenderTarget(e)}}};THREE.Water.prototype=Object.create(THREE.Mesh.prototype);THREE.Water.prototype.constructor=THREE.Water;THREE.MapControls=function(a,c){function f(){return Math.pow(.95,b.zoomSpeed)}function g(a){b.object.isPerspectiveCamera?H/=a:b.object.isOrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom*a)),b.object.updateProjectionMatrix(),F=!0):(console.warn("WARNING: MapControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function l(a){b.object.isPerspectiveCamera?H*=a:b.object.isOrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom/a)),b.object.updateProjectionMatrix(),F=!0):(console.warn("WARNING: MapControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function p(a){if(!1!==b.enabled){a.preventDefault();switch(a.button){case b.mouseButtons.LEFT:if(a.ctrlKey||a.metaKey||a.shiftKey){if(!1===b.enableRotate)return;J.set(a.clientX,a.clientY);h=q.ROTATE}else{if(!1===b.enablePan)return;t.set(a.clientX,a.clientY);h=q.PAN}break;case b.mouseButtons.MIDDLE:if(!1===b.enableZoom)return;E.set(a.clientX,a.clientY);h=q.DOLLY;break;case b.mouseButtons.RIGHT:if(!1===b.enableRotate)return;J.set(a.clientX,a.clientY);h=q.ROTATE}h!==q.NONE&&(document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",w,!1),b.dispatchEvent(v))}}function d(a){if(!1!==b.enabled)switch(a.preventDefault(),h){case q.ROTATE:if(!1===b.enableRotate)break;I.set(a.clientX,a.clientY);M.subVectors(I,J).multiplyScalar(b.rotateSpeed);a=b.domElement===document?b.domElement.body:b.domElement;z.theta-=2*Math.PI*M.x/a.clientHeight;z.phi-=2*Math.PI*M.y/a.clientHeight;J.copy(I);b.update();break;case q.DOLLY:if(!1===b.enableZoom)break;Q.set(a.clientX,a.clientY);S.subVectors(Q,E);0<S.y?g(f()):0>S.y&&l(f());E.copy(Q);b.update();break;case q.PAN:!1!==b.enablePan&&(G.set(a.clientX,a.clientY),P.subVectors(G,t).multiplyScalar(b.panSpeed),R(P.x,P.y),t.copy(G),b.update())}}function w(a){!1!==b.enabled&&(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",w,!1),b.dispatchEvent(y),h=q.NONE)}function e(a){!1===b.enabled||!1===b.enableZoom||h!==q.NONE&&h!==q.ROTATE||(a.preventDefault(),a.stopPropagation(),b.dispatchEvent(v),0>a.deltaY?l(f()):0<a.deltaY&&g(f()),b.update(),b.dispatchEvent(y))}function m(a){if(!1!==b.enabled&&!1!==b.enableKeys&&!1!==b.enablePan)switch(a.keyCode){case b.keys.UP:R(0,b.keyPanSpeed);b.update();break;case b.keys.BOTTOM:R(0,-b.keyPanSpeed);b.update();break;case b.keys.LEFT:R(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:R(-b.keyPanSpeed,0),b.update()}}function A(a){if(!1!==b.enabled){a.preventDefault();switch(a.touches.length){case 1:if(!1===b.enablePan)return;b.enablePan&&t.set(a.touches[0].pageX,a.touches[0].pageY);h=q.PAN;break;case 2:if(!1===b.enableZoom&&!1===b.enableRotate)return;J.set(a.touches[0].pageX,a.touches[0].pageY);L.set(a.touches[1].pageX,a.touches[1].pageY);if(b.enableZoom){var n=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;E.set(0,Math.sqrt(n*n+a*a))}h=q.DOLLY_ROTATE;break;default:h=q.NONE}h!==q.NONE&&b.dispatchEvent(v)}}function C(a){if(!1!==b.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===b.enablePan)break;if(h!==q.PAN)break;!1!==b.enablePan&&0!==(h&q.PAN)&&(G.set(a.touches[0].pageX,a.touches[0].pageY),P.subVectors(G,t).multiplyScalar(b.panSpeed),R(P.x,P.y),t.copy(G));b.update();break;case 2:if(!1===b.enableZoom&&!1===b.enableRotate)break;if(0===(h&q.DOLLY_ROTATE))break;!1!==b.enableRotate&&0!==(h&q.ROTATE)&&(I.set(a.touches[0].pageX,a.touches[0].pageY),N.set(a.touches[1].pageX,a.touches[1].pageY),M.subVectors(I,J),O.subVectors(N,L),k.subVectors(L,J),n.subVectors(N,I),V(k)&&V(n)&&W(M)&&W(O)&&0<M.dot(O)?(z.phi-=2*Math.PI*M.y/(b.domElement===document?b.domElement.body:b.domElement).clientHeight,h=q.ROTATE_UP):0!==(h&q.ROTATE_LEFT)&&(z.theta-=(k.angle()-n.angle())*b.rotateSpeed),J.copy(I),L.copy(N));if(!1!==b.enableZoom&&0!==(h&q.DOLLY)){var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;Q.set(0,Math.sqrt(c*c+a*a));S.set(0,Math.pow(Q.y/E.y,b.zoomSpeed));g(S.y);E.copy(Q)}b.update();break;default:h=q.NONE}}function B(a){!1!==b.enabled&&(b.dispatchEvent(y),h=q.NONE)}function x(a){!1!==b.enabled&&a.preventDefault()}this.object=a;this.domElement=void 0!==c?c:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.panSpeed=1;this.screenSpacePanning=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return u.phi};this.getAzimuthalAngle=function(){return u.theta};this.saveState=function(){b.target0.copy(b.target);b.position0.copy(b.object.position);b.zoom0=b.object.zoom};this.reset=function(){b.target.copy(b.target0);b.object.position.copy(b.position0);b.object.zoom=b.zoom0;b.object.updateProjectionMatrix();b.dispatchEvent(r);b.update();h=q.NONE};this.update=function(){var n=new THREE.Vector3,k=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),c=k.clone().inverse(),t=new THREE.Vector3,e=new THREE.Quaternion;return function(){var a=b.object.position;n.copy(a).sub(b.target);n.applyQuaternion(k);u.setFromVector3(n);b.autoRotate&&h===q.NONE&&(z.theta-=2*Math.PI/60/60*b.autoRotateSpeed);u.theta+=z.theta;u.phi+=z.phi;u.theta=Math.max(b.minAzimuthAngle,Math.min(b.maxAzimuthAngle,u.theta));u.phi=Math.max(b.minPolarAngle,Math.min(b.maxPolarAngle,u.phi));u.makeSafe();u.radius*=H;u.radius=Math.max(b.minDistance,Math.min(b.maxDistance,u.radius));b.target.add(K);n.setFromSpherical(u);n.applyQuaternion(c);a.copy(b.target).add(n);b.object.lookAt(b.target);!0===b.enableDamping?(z.theta*=1-b.dampingFactor,z.phi*=1-b.dampingFactor,K.multiplyScalar(1-b.dampingFactor)):(z.set(0,0,0),K.set(0,0,0));H=1;return F||t.distanceToSquared(b.object.position)>D||8*(1-e.dot(b.object.quaternion))>D?(b.dispatchEvent(r),t.copy(b.object.position),e.copy(b.object.quaternion),F=!1,!0):!1}}();this.dispose=function(){b.domElement.removeEventListener("contextmenu",x,!1);b.domElement.removeEventListener("mousedown",p,!1);b.domElement.removeEventListener("wheel",e,!1);b.domElement.removeEventListener("touchstart",A,!1);b.domElement.removeEventListener("touchend",B,!1);b.domElement.removeEventListener("touchmove",C,!1);document.removeEventListener("mousemove",d,!1);document.removeEventListener("mouseup",w,!1);window.removeEventListener("keydown",m,!1)};var b=this,r={type:"change"},v={type:"start"},y={type:"end"},q={NONE:0,ROTATE_UP:1,ROTATE_LEFT:2,ROTATE:3,DOLLY:4,DOLLY_ROTATE:7,PAN:8,DOLLY_PAN:12},h=q.NONE,D=1E-6,u=new THREE.Spherical,z=new THREE.Spherical,H=1,K=new THREE.Vector3,F=!1,J=new THREE.Vector2,L=new THREE.Vector2,I=new THREE.Vector2,N=new THREE.Vector2,M=new THREE.Vector2,O=new THREE.Vector2,k=new THREE.Vector2,n=new THREE.Vector2,t=new THREE.Vector2,G=new THREE.Vector2,P=new THREE.Vector2,E=new THREE.Vector2,Q=new THREE.Vector2,S=new THREE.Vector2,T=function(){var a=new THREE.Vector3;return function(b,n){a.setFromMatrixColumn(n,0);a.multiplyScalar(-b);K.add(a)}}(),U=function(){var a=new THREE.Vector3;return function(n,k){!0===b.screenSpacePanning?a.setFromMatrixColumn(k,1):(a.setFromMatrixColumn(k,0),a.crossVectors(b.object.up,a));a.multiplyScalar(n);K.add(a)}}(),R=function(){var a=new THREE.Vector3;return function(n,k){var c=b.domElement===document?b.domElement.body:b.domElement;if(b.object.isPerspectiveCamera){a.copy(b.object.position).sub(b.target);var t=a.length(),t=t*Math.tan(b.object.fov/2*Math.PI/180);T(2*n*t/c.clientHeight,b.object.matrix);U(2*k*t/c.clientHeight,b.object.matrix)}else b.object.isOrthographicCamera?(T(n*(b.object.right-b.object.left)/b.object.zoom/c.clientWidth,b.object.matrix),U(k*(b.object.top-b.object.bottom)/b.object.zoom/c.clientHeight,b.object.matrix)):(console.warn("WARNING: MapControls.js encountered an unknown camera type - pan disabled."),b.enablePan=!1)}}(),V=function(){var a=Math.sin(Math.PI/6);return function(b){return Math.abs(Math.sin(b.angle()))<a}}(),W=function(){var a=Math.cos(Math.PI/2-Math.PI/6);return function(b){return Math.abs(Math.cos(b.angle()))<a}}();b.domElement.addEventListener("contextmenu",x,!1);b.domElement.addEventListener("mousedown",p,!1);b.domElement.addEventListener("wheel",e,!1);b.domElement.addEventListener("touchstart",A,!1);b.domElement.addEventListener("touchend",B,!1);b.domElement.addEventListener("touchmove",C,!1);window.addEventListener("keydown",m,!1);this.update()};THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.MapControls.prototype.constructor=THREE.MapControls;Object.defineProperties(THREE.MapControls.prototype,{center:{get:function(){console.warn("THREE.MapControls: .center has been renamed to .target");return this.target}},noZoom:{get:function(){console.warn("THREE.MapControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(a){console.warn("THREE.MapControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!a}},noRotate:{get:function(){console.warn("THREE.MapControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function(a){console.warn("THREE.MapControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!a}},noPan:{get:function(){console.warn("THREE.MapControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(a){console.warn("THREE.MapControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!a}},noKeys:{get:function(){console.warn("THREE.MapControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function(a){console.warn("THREE.MapControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!a}},staticMoving:{get:function(){console.warn("THREE.MapControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.enableDamping},set:function(a){console.warn("THREE.MapControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.enableDamping=!a}},dynamicDampingFactor:{get:function(){console.warn("THREE.MapControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.dampingFactor},set:function(a){console.warn("THREE.MapControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.dampingFactor=a}}});THREE.GLTFLoader=function(){function a(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.dracoLoader=null}function c(){var a={};return{get:function(b){return a[b]},add:function(b,k){a[b]=k},remove:function(b){delete a[b]},removeAll:function(){a={}}}}function f(){if(!THREE.DDSLoader)throw Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=h.MSFT_TEXTURE_DDS;this.ddsLoader=new THREE.DDSLoader}function g(a){this.name=h.KHR_LIGHTS_PUNCTUAL;this.lightDefs=(a.extensions&&a.extensions[h.KHR_LIGHTS_PUNCTUAL]||{}).lights||[]}function l(a){this.name=h.KHR_MATERIALS_UNLIT}function p(a){this.name=h.KHR_BINARY_GLTF;this.body=this.content=null;var b=new DataView(a,0,u);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(a.slice(0,4))),version:b.getUint32(4,!0),length:b.getUint32(8,!0)};if(this.header.magic!==D)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(2>this.header.version)throw Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var b=new DataView(a,u),k=0;k<b.byteLength;){var c=b.getUint32(k,!0),k=k+4,e=b.getUint32(k,!0),k=k+4;e===z.JSON?(e=new Uint8Array(a,u+k,c),this.content=THREE.LoaderUtils.decodeText(e)):e===z.BIN&&(e=u+k,this.body=a.slice(e,e+c));k+=c}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.");}function d(a,b){if(!b)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=h.KHR_DRACO_MESH_COMPRESSION;this.json=a;this.dracoLoader=b}function w(a){this.name=h.KHR_TEXTURE_TRANSFORM}function e(){return{name:h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:"color map lightMap lightMapIntensity aoMap aoMapIntensity emissive emissiveIntensity emissiveMap bumpMap bumpScale normalMap displacementMap displacementScale displacementBias specularMap specular glossinessMap glossiness alphaMap envMap envMapIntensity refractionRatio".split(" "),getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(a,b,c){b=b.extensions[this.name];var n=THREE.ShaderLib.standard,k=THREE.UniformsUtils.clone(n.uniforms),e=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include \x3croughnessmap_pars_fragment\x3e","#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif").replace("#include \x3cmetalnessmap_pars_fragment\x3e","#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif").replace("#include \x3croughnessmap_fragment\x3e","vec3 specularFactor \x3d specular;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular \x3d texture2D( specularMap, vUv );\n\ttexelSpecular \x3d sRGBToLinear( texelSpecular );\n\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tspecularFactor *\x3d texelSpecular.rgb;\n#endif").replace("#include \x3cmetalnessmap_fragment\x3e","float glossinessFactor \x3d glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tvec4 texelGlossiness \x3d texture2D( glossinessMap, vUv );\n\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tglossinessFactor *\x3d texelGlossiness.a;\n#endif").replace("#include \x3clights_physical_fragment\x3e","PhysicalMaterial material;\nmaterial.diffuseColor \x3d diffuseColor.rgb;\nmaterial.specularRoughness \x3d clamp( 1.0 - glossinessFactor, 0.04, 1.0 );\nmaterial.specularColor \x3d specularFactor.rgb;");delete k.roughness;delete k.metalness;delete k.roughnessMap;delete k.metalnessMap;k.specular={value:(new THREE.Color).setHex(1118481)};k.glossiness={value:.5};k.specularMap={value:null};k.glossinessMap={value:null};a.vertexShader=n.vertexShader;a.fragmentShader=e;a.uniforms=k;a.defines={STANDARD:""};a.color=new THREE.Color(1,1,1);a.opacity=1;n=[];Array.isArray(b.diffuseFactor)&&(k=b.diffuseFactor,a.color.fromArray(k),a.opacity=k[3]);void 0!==b.diffuseTexture&&n.push(c.assignTexture(a,"map",b.diffuseTexture));a.emissive=new THREE.Color(0,0,0);a.glossiness=void 0!==b.glossinessFactor?b.glossinessFactor:1;a.specular=new THREE.Color(1,1,1);Array.isArray(b.specularFactor)&&a.specular.fromArray(b.specularFactor);void 0!==b.specularGlossinessTexture&&(b=b.specularGlossinessTexture,n.push(c.assignTexture(a,"glossinessMap",b)),n.push(c.assignTexture(a,"specularMap",b)));return Promise.all(n)},createMaterial:function(a){var b=new THREE.ShaderMaterial({defines:a.defines,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,uniforms:a.uniforms,fog:!0,lights:!0,opacity:a.opacity,transparent:a.transparent});b.isGLTFSpecularGlossinessMaterial=!0;b.color=a.color;b.map=void 0===a.map?null:a.map;b.lightMap=null;b.lightMapIntensity=1;b.aoMap=void 0===a.aoMap?null:a.aoMap;b.aoMapIntensity=1;b.emissive=a.emissive;b.emissiveIntensity=1;b.emissiveMap=void 0===a.emissiveMap?null:a.emissiveMap;b.bumpMap=void 0===a.bumpMap?null:a.bumpMap;b.bumpScale=1;b.normalMap=void 0===a.normalMap?null:a.normalMap;a.normalScale&&(b.normalScale=a.normalScale);b.displacementMap=null;b.displacementScale=1;b.displacementBias=0;b.specularMap=void 0===a.specularMap?null:a.specularMap;b.specular=a.specular;b.glossinessMap=void 0===a.glossinessMap?null:a.glossinessMap;b.glossiness=a.glossiness;b.alphaMap=null;b.envMap=void 0===a.envMap?null:a.envMap;b.envMapIntensity=1;b.refractionRatio=.98;b.extensions.derivatives=!0;return b},cloneMaterial:function(a){var b=a.clone();b.isGLTFSpecularGlossinessMaterial=!0;for(var k=this.specularGlossinessParams,c=0,e=k.length;c<e;c++)b[k[c]]=a[k[c]];return b},refreshUniforms:function(a,b,c,e,d,f){if(!0===d.isGLTFSpecularGlossinessMaterial){b=d.uniforms;c=d.defines;b.opacity.value=d.opacity;b.diffuse.value.copy(d.color);b.emissive.value.copy(d.emissive).multiplyScalar(d.emissiveIntensity);b.map.value=d.map;b.specularMap.value=d.specularMap;b.alphaMap.value=d.alphaMap;b.lightMap.value=d.lightMap;b.lightMapIntensity.value=d.lightMapIntensity;b.aoMap.value=d.aoMap;b.aoMapIntensity.value=d.aoMapIntensity;var k;d.map?k=d.map:d.specularMap?k=d.specularMap:d.displacementMap?k=d.displacementMap:d.normalMap?k=d.normalMap:d.bumpMap?k=d.bumpMap:d.glossinessMap?k=d.glossinessMap:d.alphaMap?k=d.alphaMap:d.emissiveMap&&(k=d.emissiveMap);void 0!==k&&(k.isWebGLRenderTarget&&(k=k.texture),!0===k.matrixAutoUpdate&&k.updateMatrix(),b.uvTransform.value.copy(k.matrix));d.envMap&&(b.envMap.value=d.envMap,b.envMapIntensity.value=d.envMapIntensity,b.flipEnvMap.value=d.envMap.isCubeTexture?-1:1,b.reflectivity.value=d.reflectivity,b.refractionRatio.value=d.refractionRatio,b.maxMipLevel.value=a.properties.get(d.envMap).__maxMipLevel);b.specular.value.copy(d.specular);b.glossiness.value=d.glossiness;b.glossinessMap.value=d.glossinessMap;b.emissiveMap.value=d.emissiveMap;b.bumpMap.value=d.bumpMap;b.normalMap.value=d.normalMap;b.displacementMap.value=d.displacementMap;b.displacementScale.value=d.displacementScale;b.displacementBias.value=d.displacementBias;null!==b.glossinessMap.value&&void 0===c.USE_GLOSSINESSMAP&&(c.USE_GLOSSINESSMAP="",c.USE_ROUGHNESSMAP="");null===b.glossinessMap.value&&void 0!==c.USE_GLOSSINESSMAP&&(delete c.USE_GLOSSINESSMAP,delete c.USE_ROUGHNESSMAP)}}}}function m(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)}function A(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function C(a,b,c){for(var k in c.extensions)void 0===a[k]&&(b.userData.gltfExtensions=b.userData.gltfExtensions||{},b.userData.gltfExtensions[k]=c.extensions[k])}function B(a,b){void 0!==b.extras&&("object"===typeof b.extras?a.userData=b.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+b.extras))}function x(a,b,c){for(var d=!1,k=!1,n=0,e=b.length;n<e;n++){var t=b[n];void 0!==t.POSITION&&(d=!0);void 0!==t.NORMAL&&(k=!0);if(d&&k)break}if(!d&&!k)return Promise.resolve(a);for(var f=[],g=[],n=0,e=b.length;n<e;n++){t=b[n];if(d){var h=void 0!==t.POSITION?c.getDependency("accessor",t.POSITION):a.attributes.position;f.push(h)}k&&(h=void 0!==t.NORMAL?c.getDependency("accessor",t.NORMAL):a.attributes.normal,g.push(h))}return Promise.all([Promise.all(f),Promise.all(g)]).then(function(c){var n=c[0];c=c[1];for(var e=0,t=n.length;e<t;e++)a.attributes.position!==n[e]&&(n[e]=v(n[e]));e=0;for(t=c.length;e<t;e++)a.attributes.normal!==c[e]&&(c[e]=v(c[e]));e=0;for(t=b.length;e<t;e++){var f=b[e],G="morphTarget"+e;if(d&&void 0!==f.POSITION){var g=n[e];g.name=G;for(var P=a.attributes.position,E=0,h=g.count;E<h;E++)g.setXYZ(E,g.getX(E)+P.getX(E),g.getY(E)+P.getY(E),g.getZ(E)+P.getZ(E))}if(k&&void 0!==f.NORMAL)for(f=c[e],f.name=G,G=a.attributes.normal,E=0,h=f.count;E<h;E++)f.setXYZ(E,f.getX(E)+G.getX(E),f.getY(E)+G.getY(E),f.getZ(E)+G.getZ(E))}d&&(a.morphAttributes.position=n);k&&(a.morphAttributes.normal=c);return a})}function b(a){var b=a.extensions&&a.extensions[h.KHR_DRACO_MESH_COMPRESSION];return b?"draco:"+b.bufferView+":"+b.indices+":"+r(b.attributes):a.indices+":"+r(a.attributes)+":"+a.mode}function r(a){for(var b="",c=Object.keys(a).sort(),d=0,e=c.length;d<e;d++)b+=c[d]+":"+a[c[d]]+";";return b}function v(a){if(a.isInterleavedBufferAttribute){for(var b=a.count,c=a.itemSize,d=a.array.slice(0,b*c),e=0,k=0;e<b;++e)d[k++]=a.getX(e),2<=c&&(d[k++]=a.getY(e)),3<=c&&(d[k++]=a.getZ(e)),4<=c&&(d[k++]=a.getW(e));return new THREE.BufferAttribute(d,c,a.normalized)}return a.clone()}function y(a,b,d){this.json=a||{};this.extensions=b||{};this.options=d||{};this.cache=new c;this.primitiveCache={};this.textureLoader=new THREE.TextureLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer")}function q(a,b,c){function d(b,d){return c.getDependency("accessor",b).then(function(b){a.addAttribute(d,b)})}var e=b.attributes,k=[],n;for(n in e){var t=L[n]||n.toLowerCase();t in a.attributes||k.push(d(e[n],t))}void 0===b.indices||a.index||(e=c.getDependency("accessor",b.indices).then(function(b){a.setIndex(b)}),k.push(e));B(a,b);return Promise.all(k).then(function(){return void 0!==b.targets?x(a,b.targets,c):a})}a.prototype={constructor:a,crossOrigin:"anonymous",load:function(a,b,c,d){var e=this,k;k=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(a);e.manager.itemStart(a);var n=function(b){d?d(b):console.error(b);e.manager.itemError(a);e.manager.itemEnd(a)},t=new THREE.FileLoader(e.manager);t.setPath(this.path);t.setResponseType("arraybuffer");t.load(a,function(c){try{e.parse(c,k,function(c){b(c);e.manager.itemEnd(a)},n)}catch(U){n(U)}},c,n)},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this},setResourcePath:function(a){this.resourcePath=a;return this},setDRACOLoader:function(a){this.dracoLoader=a;return this},parse:function(a,b,c,G){var n={};if("string"!==typeof a)if(THREE.LoaderUtils.decodeText(new Uint8Array(a,0,4))===D){try{n[h.KHR_BINARY_GLTF]=new p(a)}catch(T){G&&G(T);return}a=n[h.KHR_BINARY_GLTF].content}else a=THREE.LoaderUtils.decodeText(new Uint8Array(a));a=JSON.parse(a);if(void 0===a.asset||2>a.asset.version[0])G&&G(Error("THREE.GLTFLoader: Unsupported asset. glTF versions \x3e\x3d2.0 are supported. Use LegacyGLTFLoader instead."));else{if(a.extensionsUsed)for(var k=0;k<a.extensionsUsed.length;++k){var t=a.extensionsUsed[k],q=a.extensionsRequired||[];switch(t){case h.KHR_LIGHTS_PUNCTUAL:n[t]=new g(a);break;case h.KHR_MATERIALS_UNLIT:n[t]=new l(a);break;case h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:n[t]=new e(a);break;case h.KHR_DRACO_MESH_COMPRESSION:n[t]=new d(a,this.dracoLoader);break;case h.MSFT_TEXTURE_DDS:n[h.MSFT_TEXTURE_DDS]=new f;break;case h.KHR_TEXTURE_TRANSFORM:n[h.KHR_TEXTURE_TRANSFORM]=new w(a);break;default:0<=q.indexOf(t)&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}(new y(a,n,{path:b||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager})).parse(c,G)}}};var h={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};g.prototype.loadLight=function(a){var b=this.lightDefs[a],c;c=new THREE.Color(16777215);void 0!==b.color&&c.fromArray(b.color);var d=void 0!==b.range?b.range:0;switch(b.type){case "directional":c=new THREE.DirectionalLight(c);c.target.position.set(0,0,-1);c.add(c.target);break;case "point":c=new THREE.PointLight(c);c.distance=d;break;case "spot":c=new THREE.SpotLight(c);c.distance=d;b.spot=b.spot||{};b.spot.innerConeAngle=void 0!==b.spot.innerConeAngle?b.spot.innerConeAngle:0;b.spot.outerConeAngle=void 0!==b.spot.outerConeAngle?b.spot.outerConeAngle:Math.PI/4;c.angle=b.spot.outerConeAngle;c.penumbra=1-b.spot.innerConeAngle/b.spot.outerConeAngle;c.target.position.set(0,0,-1);c.add(c.target);break;default:throw Error('THREE.GLTFLoader: Unexpected light type, "'+b.type+'".');}c.position.set(0,0,0);c.decay=2;void 0!==b.intensity&&(c.intensity=b.intensity);c.name=b.name||"light_"+a;return Promise.resolve(c)};l.prototype.getMaterialType=function(a){return THREE.MeshBasicMaterial};l.prototype.extendParams=function(a,b,c){var d=[];a.color=new THREE.Color(1,1,1);a.opacity=1;if(b=b.pbrMetallicRoughness){if(Array.isArray(b.baseColorFactor)){var e=b.baseColorFactor;a.color.fromArray(e);a.opacity=e[3]}void 0!==b.baseColorTexture&&d.push(c.assignTexture(a,"map",b.baseColorTexture))}return Promise.all(d)};var D="glTF",u=12,z={JSON:1313821514,BIN:5130562};d.prototype.decodePrimitive=function(a,b){var c=this.json,d=this.dracoLoader,e=a.extensions[this.name].bufferView,n=a.extensions[this.name].attributes,k={},f={},g={},h;for(h in n){var l=L[h]||h.toLowerCase();k[l]=n[h]}for(h in a.attributes)if(l=L[h]||h.toLowerCase(),void 0!==n[h]){var p=c.accessors[a.attributes[h]];g[l]=H[p.componentType];f[l]=!0===p.normalized}return b.getDependency("bufferView",e).then(function(a){return new Promise(function(b){d.decodeDracoFile(a,function(a){for(var c in a.attributes){var d=a.attributes[c],e=f[c];void 0!==e&&(d.normalized=e)}b(a)},k,g)})})};w.prototype.extendTexture=function(a,b){a=a.clone();void 0!==b.offset&&a.offset.fromArray(b.offset);void 0!==b.rotation&&(a.rotation=b.rotation);void 0!==b.scale&&a.repeat.fromArray(b.scale);void 0!==b.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.');a.needsUpdate=!0;return a};m.prototype=Object.create(THREE.Interpolant.prototype);m.prototype.constructor=m;m.prototype.copySampleValue_=function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a=a*d*3+d;for(var e=0;e!==d;e++)b[e]=c[a+e];return b};m.prototype.beforeStart_=m.prototype.copySampleValue_;m.prototype.afterEnd_=m.prototype.copySampleValue_;m.prototype.interpolate_=function(a,b,c,d){var e=this.resultBuffer,n=this.sampleValues,f=this.valueSize,k=2*f,t=3*f;d-=b;b=(c-b)/d;c=b*b;var g=c*b;a*=t;var t=a-t,h=-2*g+3*c,g=g-c,G=1-h;b=g-c+b;for(c=0;c!==f;c++)e[c]=G*n[t+c+f]+b*n[t+c+k]*d+h*n[a+c+f]+g*n[a+c]*d;return e};var H={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},K={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},F={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},J={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},L={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},N={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},M={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat},O;y.prototype.parse=function(a,b){var c=this,d=this.json,e=this.extensions;this.cache.removeAll();this.markDefs();Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(b){b={scene:b[0][d.scene||0],scenes:b[0],animations:b[1],cameras:b[2],asset:d.asset,parser:c,userData:{}};C(e,b,d);a(b)}).catch(b)};y.prototype.markDefs=function(){for(var a=this.json.nodes||[],b=this.json.skins||[],c=this.json.meshes||[],d={},e={},f=0,g=b.length;f<g;f++)for(var h=b[f].joints,l=0,p=h.length;l<p;l++)a[h[l]].isBone=!0;b=0;for(f=a.length;b<f;b++)g=a[b],void 0!==g.mesh&&(void 0===d[g.mesh]&&(d[g.mesh]=e[g.mesh]=0),d[g.mesh]++,void 0!==g.skin&&(c[g.mesh].isSkinnedMesh=!0));this.json.meshReferences=d;this.json.meshUses=e};y.prototype.getDependency=function(a,b){var c=a+":"+b,d=this.cache.get(c);if(!d){switch(a){case "scene":d=this.loadScene(b);break;case "node":d=this.loadNode(b);break;case "mesh":d=this.loadMesh(b);break;case "accessor":d=this.loadAccessor(b);break;case "bufferView":d=this.loadBufferView(b);break;case "buffer":d=this.loadBuffer(b);break;case "material":d=this.loadMaterial(b);break;case "texture":d=this.loadTexture(b);break;case "skin":d=this.loadSkin(b);break;case "animation":d=this.loadAnimation(b);break;case "camera":d=this.loadCamera(b);break;case "light":d=this.extensions[h.KHR_LIGHTS_PUNCTUAL].loadLight(b);break;default:throw Error("Unknown type: "+a);}this.cache.add(c,d)}return d};y.prototype.getDependencies=function(a){var b=this.cache.get(a);if(!b){var c=this,b=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(b,d){return c.getDependency(a,d)}));this.cache.add(a,b)}return b};y.prototype.loadBuffer=function(a){var b=this.json.buffers[a],c=this.fileLoader;if(b.type&&"arraybuffer"!==b.type)throw Error("THREE.GLTFLoader: "+b.type+" buffer type is not supported.");if(void 0===b.uri&&0===a)return Promise.resolve(this.extensions[h.KHR_BINARY_GLTF].body);var d=this.options;return new Promise(function(a,e){c.load(A(b.uri,d.path),a,void 0,function(){e(Error('THREE.GLTFLoader: Failed to load buffer "'+b.uri+'".'))})})};y.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteOffset||0;return a.slice(c,c+(b.byteLength||0))})};y.prototype.loadAccessor=function(a){var b=this,c=this.json,d=this.json.accessors[a];if(void 0===d.bufferView&&void 0===d.sparse)return Promise.resolve(null);a=[];void 0!==d.bufferView?a.push(this.getDependency("bufferView",d.bufferView)):a.push(null);void 0!==d.sparse&&(a.push(this.getDependency("bufferView",d.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",d.sparse.values.bufferView)));return Promise.all(a).then(function(a){var e=a[0],f=J[d.type],n=H[d.componentType],k=n.BYTES_PER_ELEMENT,g=d.byteOffset||0,t=void 0!==d.bufferView?c.bufferViews[d.bufferView].byteStride:void 0,h=!0===d.normalized,l;if(t&&t!==k*f){var p="InterleavedBuffer:"+d.bufferView+":"+d.componentType;l=b.cache.get(p);l||(l=new n(e),l=new THREE.InterleavedBuffer(l,t/k),b.cache.add(p,l));k=new THREE.InterleavedBufferAttribute(l,f,g/k,h)}else l=null===e?new n(d.count*f):new n(e,g,d.count*f),k=new THREE.BufferAttribute(l,f,h);if(void 0!==d.sparse)for(t=d.sparse.values.byteOffset||0,g=new H[d.sparse.indices.componentType](a[1],d.sparse.indices.byteOffset||0,d.sparse.count*J.SCALAR),a=new n(a[2],t,d.sparse.count*f),null!==e&&k.setArray(k.array.slice()),e=0,n=g.length;e<n;e++)if(t=g[e],k.setX(t,a[e*f]),2<=f&&k.setY(t,a[e*f+1]),3<=f&&k.setZ(t,a[e*f+2]),4<=f&&k.setW(t,a[e*f+3]),5<=f)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.");return k})};y.prototype.loadTexture=function(a){var b=this,c=this.json,d=this.options,e=this.textureLoader,f=window.URL||window.webkitURL,k=c.textures[a],g=k.extensions||{},l;l=g[h.MSFT_TEXTURE_DDS]?c.images[g[h.MSFT_TEXTURE_DDS].source]:c.images[k.source];var p=l.uri,q=!1;void 0!==l.bufferView&&(p=b.getDependency("bufferView",l.bufferView).then(function(a){q=!0;a=new Blob([a],{type:l.mimeType});return p=f.createObjectURL(a)}));return Promise.resolve(p).then(function(a){var c=THREE.Loader.Handlers.get(a);c||(c=g[h.MSFT_TEXTURE_DDS]?b.extensions[h.MSFT_TEXTURE_DDS].ddsLoader:e);return new Promise(function(b,e){c.load(A(a,d.path),b,void 0,e)})}).then(function(a){!0===q&&f.revokeObjectURL(p);a.flipY=!1;void 0!==k.name&&(a.name=k.name);l.mimeType in M&&(a.format=M[l.mimeType]);var b=(c.samplers||{})[k.sampler]||{};a.magFilter=K[b.magFilter]||THREE.LinearFilter;a.minFilter=K[b.minFilter]||THREE.LinearMipMapLinearFilter;a.wrapS=F[b.wrapS]||THREE.RepeatWrapping;a.wrapT=F[b.wrapT]||THREE.RepeatWrapping;return a})};y.prototype.assignTexture=function(a,b,c){var d=this;return this.getDependency("texture",c.index).then(function(e){switch(b){case "aoMap":case "emissiveMap":case "metalnessMap":case "normalMap":case "roughnessMap":e.format=THREE.RGBFormat}if(d.extensions[h.KHR_TEXTURE_TRANSFORM]){var f=void 0!==c.extensions?c.extensions[h.KHR_TEXTURE_TRANSFORM]:void 0;f&&(e=d.extensions[h.KHR_TEXTURE_TRANSFORM].extendTexture(e,f))}a[b]=e})};y.prototype.assignFinalMaterial=function(a){var b=a.geometry,c=a.material,d=this.extensions,e=void 0!==b.attributes.tangent,f=void 0!==b.attributes.color,g=void 0===b.attributes.normal,k=!0===a.isSkinnedMesh,l=0<Object.keys(b.morphAttributes).length,p=l&&void 0!==b.morphAttributes.normal;if(a.isPoints){var q="PointsMaterial:"+c.uuid,m=this.cache.get(q);m||(m=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(m,c),m.color.copy(c.color),m.map=c.map,m.lights=!1,this.cache.add(q,m));c=m}else a.isLine&&(q="LineBasicMaterial:"+c.uuid,m=this.cache.get(q),m||(m=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(m,c),m.color.copy(c.color),m.lights=!1,this.cache.add(q,m)),c=m);if(e||f||g||k||l)q="ClonedMaterial:"+c.uuid+":",c.isGLTFSpecularGlossinessMaterial&&(q+="specular-glossiness:"),k&&(q+="skinning:"),e&&(q+="vertex-tangents:"),f&&(q+="vertex-colors:"),g&&(q+="flat-shading:"),l&&(q+="morph-targets:"),p&&(q+="morph-normals:"),m=this.cache.get(q),m||(m=c.isGLTFSpecularGlossinessMaterial?d[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(c):c.clone(),k&&(m.skinning=!0),e&&(m.vertexTangents=!0),f&&(m.vertexColors=THREE.VertexColors),g&&(m.flatShading=!0),l&&(m.morphTargets=!0),p&&(m.morphNormals=!0),this.cache.add(q,m)),c=m;c.aoMap&&void 0===b.attributes.uv2&&void 0!==b.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),b.addAttribute("uv2",new THREE.BufferAttribute(b.attributes.uv.array,2)));c.isGLTFSpecularGlossinessMaterial&&(a.onBeforeRender=d[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms);a.material=c};y.prototype.loadMaterial=function(a){var b=this.extensions,c=this.json.materials[a],d,e={},f=c.extensions||{};a=[];if(f[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS])f=b[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],d=f.getMaterialType(c),a.push(f.extendParams(e,c,this));else if(f[h.KHR_MATERIALS_UNLIT])f=b[h.KHR_MATERIALS_UNLIT],d=f.getMaterialType(c),a.push(f.extendParams(e,c,this));else{d=THREE.MeshStandardMaterial;f=c.pbrMetallicRoughness||{};e.color=new THREE.Color(1,1,1);e.opacity=1;if(Array.isArray(f.baseColorFactor)){var g=f.baseColorFactor;e.color.fromArray(g);e.opacity=g[3]}void 0!==f.baseColorTexture&&a.push(this.assignTexture(e,"map",f.baseColorTexture));e.metalness=void 0!==f.metallicFactor?f.metallicFactor:1;e.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1;void 0!==f.metallicRoughnessTexture&&(a.push(this.assignTexture(e,"metalnessMap",f.metallicRoughnessTexture)),a.push(this.assignTexture(e,"roughnessMap",f.metallicRoughnessTexture)))}!0===c.doubleSided&&(e.side=THREE.DoubleSide);f=c.alphaMode||"OPAQUE";"BLEND"===f?e.transparent=!0:(e.transparent=!1,"MASK"===f&&(e.alphaTest=void 0!==c.alphaCutoff?c.alphaCutoff:.5));void 0!==c.normalTexture&&d!==THREE.MeshBasicMaterial&&(a.push(this.assignTexture(e,"normalMap",c.normalTexture)),e.normalScale=new THREE.Vector2(1,1),void 0!==c.normalTexture.scale&&e.normalScale.set(c.normalTexture.scale,c.normalTexture.scale));void 0!==c.occlusionTexture&&d!==THREE.MeshBasicMaterial&&(a.push(this.assignTexture(e,"aoMap",c.occlusionTexture)),void 0!==c.occlusionTexture.strength&&(e.aoMapIntensity=c.occlusionTexture.strength));void 0!==c.emissiveFactor&&d!==THREE.MeshBasicMaterial&&(e.emissive=(new THREE.Color).fromArray(c.emissiveFactor));void 0!==c.emissiveTexture&&d!==THREE.MeshBasicMaterial&&a.push(this.assignTexture(e,"emissiveMap",c.emissiveTexture));return Promise.all(a).then(function(){var a;a=d===THREE.ShaderMaterial?b[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(e):new d(e);void 0!==c.name&&(a.name=c.name);a.map&&(a.map.encoding=THREE.sRGBEncoding);a.emissiveMap&&(a.emissiveMap.encoding=THREE.sRGBEncoding);a.specularMap&&(a.specularMap.encoding=THREE.sRGBEncoding);B(a,c);c.extensions&&C(b,a,c);return a})};y.prototype.loadGeometries=function(a){function c(a){return e[h.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,d).then(function(b){return q(b,a,d)})}for(var d=this,e=this.extensions,f=this.primitiveCache,g=[],k=0,l=a.length;k<l;k++){var m=a[k],p=b(m),r=f[p];r?g.push(r.promise):(r=m.extensions&&m.extensions[h.KHR_DRACO_MESH_COMPRESSION]?c(m):q(new THREE.BufferGeometry,m,d),f[p]={primitive:m,promise:r},g.push(r))}return Promise.all(g)};y.prototype.loadMesh=function(a){for(var b=this,c=this.json.meshes[a],d=c.primitives,e=[],f=0,g=d.length;f<g;f++){var k;k=void 0===d[f].material?O=O||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",d[f].material);e.push(k)}return Promise.all(e).then(function(e){return b.loadGeometries(d).then(function(f){for(var g=[],k=0,n=f.length;k<n;k++){var h=f[k],l=d[k],m=e[k];if(4===l.mode||5===l.mode||6===l.mode||void 0===l.mode)h=!0===c.isSkinnedMesh?new THREE.SkinnedMesh(h,m):new THREE.Mesh(h,m),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),5===l.mode?h.drawMode=THREE.TriangleStripDrawMode:6===l.mode&&(h.drawMode=THREE.TriangleFanDrawMode);else if(1===l.mode)h=new THREE.LineSegments(h,m);else if(3===l.mode)h=new THREE.Line(h,m);else if(2===l.mode)h=new THREE.LineLoop(h,m);else if(0===l.mode)h=new THREE.Points(h,m);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+l.mode);if(0<Object.keys(h.geometry.morphAttributes).length){var l=h,p=c;l.updateMorphTargets();if(void 0!==p.weights)for(var m=0,q=p.weights.length;m<q;m++)l.morphTargetInfluences[m]=p.weights[m];if(p.extras&&Array.isArray(p.extras.targetNames))if(p=p.extras.targetNames,l.morphTargetInfluences.length===p.length)for(l.morphTargetDictionary={},m=0,q=p.length;m<q;m++)l.morphTargetDictionary[p[m]]=m;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}h.name=c.name||"mesh_"+a;1<f.length&&(h.name+="_"+k);B(h,c);b.assignFinalMaterial(h);g.push(h)}if(1===g.length)return g[0];f=new THREE.Group;k=0;for(n=g.length;k<n;k++)f.add(g[k]);return f})})};y.prototype.loadCamera=function(a){var b;a=this.json.cameras[a];var c=a[a.type];if(c)return"perspective"===a.type?b=new THREE.PerspectiveCamera(THREE.Math.radToDeg(c.yfov),c.aspectRatio||1,c.znear||1,c.zfar||2E6):"orthographic"===a.type&&(b=new THREE.OrthographicCamera(c.xmag/-2,c.xmag/2,c.ymag/2,c.ymag/-2,c.znear,c.zfar)),void 0!==a.name&&(b.name=a.name),B(b,a),Promise.resolve(b);console.warn("THREE.GLTFLoader: Missing camera parameters.")};y.prototype.loadSkin=function(a){a=this.json.skins[a];var b={joints:a.joints};return void 0===a.inverseBindMatrices?Promise.resolve(b):this.getDependency("accessor",a.inverseBindMatrices).then(function(a){b.inverseBindMatrices=a;return b})};y.prototype.loadAnimation=function(a){for(var b=this.json.animations[a],c=[],d=[],e=[],f=[],g=[],h=0,k=b.channels.length;h<k;h++){var l=b.channels[h],p=b.samplers[l.sampler],l=l.target,q=void 0!==b.parameters?b.parameters[p.input]:p.input,r=void 0!==b.parameters?b.parameters[p.output]:p.output;c.push(this.getDependency("node",void 0!==l.node?l.node:l.id));d.push(this.getDependency("accessor",q));e.push(this.getDependency("accessor",r));f.push(p);g.push(l)}return Promise.all([Promise.all(c),Promise.all(d),Promise.all(e),Promise.all(f),Promise.all(g)]).then(function(c){var d=c[0],e=c[1],f=c[2],g=c[3];c=c[4];for(var h=[],k=0,l=d.length;k<l;k++){var n=d[k],p=e[k],q=f[k],r=g[k],t=c[k];if(void 0!==n){n.updateMatrix();n.matrixAutoUpdate=!0;var u;switch(I[t.path]){case I.weights:u=THREE.NumberKeyframeTrack;break;case I.rotation:u=THREE.QuaternionKeyframeTrack;break;default:u=THREE.VectorKeyframeTrack}var v=n.name?n.name:n.uuid,w=void 0!==r.interpolation?N[r.interpolation]:THREE.InterpolateLinear,x=[];I[t.path]===I.weights?n.traverse(function(a){!0===a.isMesh&&a.morphTargetInfluences&&x.push(a.name?a.name:a.uuid)}):x.push(v);n=0;for(v=x.length;n<v;n++){var y=new u(x[n]+"."+I[t.path],p.array,q.array,w);"CUBICSPLINE"===r.interpolation&&(y.createInterpolant=function(a){return new m(this.times,this.values,this.getValueSize()/3,a)},y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0);h.push(y)}}}return new THREE.AnimationClip(void 0!==b.name?b.name:"animation_"+a,void 0,h)})};y.prototype.loadNode=function(a){var b=this.json,c=this.extensions,d=this,e=b.meshReferences,f=b.meshUses,g=b.nodes[a];return function(){return!0===g.isBone?Promise.resolve(new THREE.Bone):void 0!==g.mesh?d.getDependency("mesh",g.mesh).then(function(a){var b;if(1<e[g.mesh]){var c=f[g.mesh]++;b=a.clone();b.name+="_instance_"+c;b.onBeforeRender=a.onBeforeRender;for(var d=0,h=b.children.length;d<h;d++)b.children[d].name+="_instance_"+c,b.children[d].onBeforeRender=a.children[d].onBeforeRender}else b=a;void 0!==g.weights&&b.traverse(function(a){if(a.isMesh)for(var b=0,c=g.weights.length;b<c;b++)a.morphTargetInfluences[b]=g.weights[b]});return b}):void 0!==g.camera?d.getDependency("camera",g.camera):g.extensions&&g.extensions[h.KHR_LIGHTS_PUNCTUAL]&&void 0!==g.extensions[h.KHR_LIGHTS_PUNCTUAL].light?d.getDependency("light",g.extensions[h.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new THREE.Object3D)}().then(function(a){void 0!==g.name&&(a.name=THREE.PropertyBinding.sanitizeNodeName(g.name));B(a,g);g.extensions&&C(c,a,g);if(void 0!==g.matrix){var b=new THREE.Matrix4;b.fromArray(g.matrix);a.applyMatrix(b)}else void 0!==g.translation&&a.position.fromArray(g.translation),void 0!==g.rotation&&a.quaternion.fromArray(g.rotation),void 0!==g.scale&&a.scale.fromArray(g.scale);return a})};y.prototype.loadScene=function(){function a(b,c,d,e){var f=d.nodes[b];return e.getDependency("node",b).then(function(a){if(void 0===f.skin)return a;var b;return e.getDependency("skin",f.skin).then(function(a){b=a;a=[];for(var c=0,d=b.joints.length;c<d;c++)a.push(e.getDependency("node",b.joints[c]));return Promise.all(a)}).then(function(c){for(var d=!0===a.isGroup?a.children:[a],e=0,f=d.length;e<f;e++){for(var g=d[e],h=[],k=[],l=0,n=c.length;l<n;l++){var m=c[l];m?(h.push(m),m=new THREE.Matrix4,void 0!==b.inverseBindMatrices&&m.fromArray(b.inverseBindMatrices.array,16*l),k.push(m)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',b.joints[l])}g.bind(new THREE.Skeleton(h,k),g.matrixWorld)}return a})}).then(function(b){c.add(b);var g=[];if(f.children)for(var h=f.children,k=0,l=h.length;k<l;k++)g.push(a(h[k],b,d,e));return Promise.all(g)})}return function(b){var c=this.json,d=this.extensions;b=this.json.scenes[b];var e=new THREE.Scene;void 0!==b.name&&(e.name=b.name);B(e,b);b.extensions&&C(d,e,b);d=b.nodes||[];b=[];for(var f=0,g=d.length;f<g;f++)b.push(a(d[f],e,c,this));return Promise.all(b).then(function(){return e})}}();return a}();
THREE.HDRLoader=THREE.RGBELoader=function(f){this.manager=void 0!==f?f:THREE.DefaultLoadingManager;this.type=THREE.UnsignedByteType};THREE.RGBELoader.prototype=Object.create(THREE.DataTextureLoader.prototype);THREE.RGBELoader.prototype._parser=function(f){var l=function(d,b){switch(d){case 1:console.error("THREE.RGBELoader Read Error: "+(b||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(b||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(b||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(b||""))}return-1},w=function(d,b,g){b=b?b:1024;for(var u=d.pos,e,h=0,p="",a=String.fromCharCode.apply(null,new Uint16Array(d.subarray(u,u+128)));0>(e=a.indexOf("\n"))&&h<b&&u<d.byteLength;)p+=a,h+=a.length,u+=128,a+=String.fromCharCode.apply(null,new Uint16Array(d.subarray(u,u+128)));return-1<e?(!1!==g&&(d.pos+=h+e+1),p+a.slice(0,e)):!1},n=function(d,b,g){var u,e,h,p,a,r,f,c,k=g,m;if(8>b||32767<b||2!==d[0]||2!==d[1]||d[2]&128)return new Uint8Array(d);if(b!==(d[2]<<8|d[3]))return l(3,"wrong scanline width");g=new Uint8Array(4*b*g);if(!g||!g.length)return l(4,"unable to allocate buffer space");e=u=0;f=4*b;m=new Uint8Array(4);for(a=new Uint8Array(f);0<k&&e<d.byteLength;){if(e+4>d.byteLength)return l(1);m[0]=d[e++];m[1]=d[e++];m[2]=d[e++];m[3]=d[e++];if(2!=m[0]||2!=m[1]||(m[2]<<8|m[3])!=b)return l(3,"bad rgbe scanline format");for(r=0;r<f&&e<d.byteLength;){h=d[e++];(c=128<h)&&(h-=128);if(0===h||r+h>f)return l(3,"bad scanline data");if(c)for(p=d[e++],c=0;c<h;c++)a[r++]=p;else a.set(d.subarray(e,e+h),r),r+=h,e+=h}h=b;for(c=0;c<h;c++)r=0,g[u]=a[c+r],r+=b,g[u+1]=a[c+r],r+=b,g[u+2]=a[c+r],r+=b,g[u+3]=a[c+r],u+=4;k--}return g},k=new Uint8Array(f);k.pos=0;f=function(d){var b,g,c=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,e=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*FORMAT=(\S+)\s*$/,p=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(d.pos>=d.byteLength||!(b=w(d)))return l(1,"no header found");if(!(g=b.match(/^#\?(\S+)$/)))return l(3,"bad initial token");a.valid|=1;a.programtype=g[1];for(a.string+=b+"\n";;){b=w(d);if(!1===b)break;a.string+=b+"\n";if("#"===b.charAt(0))a.comments+=b+"\n";else{if(g=b.match(c))a.gamma=parseFloat(g[1],10);if(g=b.match(e))a.exposure=parseFloat(g[1],10);if(g=b.match(h))a.valid|=2,a.format=g[1];if(g=b.match(p))a.valid|=4,a.height=parseInt(g[1],10),a.width=parseInt(g[2],10);if(a.valid&2&&a.valid&4)break}}return a.valid&2?a.valid&4?a:l(3,"missing image size specifier"):l(3,"missing format specifier")}(k);if(-1!==f){var x=f.width,y=f.height,n=n(k.subarray(k.pos),x,y);if(-1!==n){if(this.type===THREE.UnsignedByteType)var c=n,q=THREE.RGBEFormat,t=THREE.UnsignedByteType;else if(this.type===THREE.FloatType){c=function(d,b,g,c){var e=Math.pow(2,d[b+3]-128)/255;g[c+0]=d[b+0]*e;g[c+1]=d[b+1]*e;g[c+2]=d[b+2]*e};q=n.length/4*3;t=new Float32Array(q);for(k=0;k<q;k++)c(n,4*k,t,3*k);c=t;q=THREE.RGBFormat;t=THREE.FloatType}else console.error("THREE.RGBELoader: unsupported type: ",this.type);return{width:x,height:y,data:c,header:f.string,gamma:f.gamma,exposure:f.exposure,format:q,type:t}}}return null};THREE.RGBELoader.prototype.setType=function(f){this.type=f;return this};THREE.HDRLoader=THREE.RGBELoader=function(f){this.manager=void 0!==f?f:THREE.DefaultLoadingManager;this.type=THREE.UnsignedByteType};THREE.RGBELoader.prototype=Object.create(THREE.DataTextureLoader.prototype);THREE.RGBELoader.prototype._parser=function(f){var l=function(d,b){switch(d){case 1:console.error("THREE.RGBELoader Read Error: "+(b||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(b||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(b||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(b||""))}return-1},w=function(d,b,g){b=b?b:1024;for(var c=d.pos,e,h=0,p="",a=String.fromCharCode.apply(null,new Uint16Array(d.subarray(c,c+128)));0>(e=a.indexOf("\n"))&&h<b&&c<d.byteLength;)p+=a,h+=a.length,c+=128,a+=String.fromCharCode.apply(null,new Uint16Array(d.subarray(c,c+128)));return-1<e?(!1!==g&&(d.pos+=h+e+1),p+a.slice(0,e)):!1},n=function(d,b,g){var c,e,h,p,a,f,k,v,n=g,m;if(8>b||32767<b||2!==d[0]||2!==d[1]||d[2]&128)return new Uint8Array(d);if(b!==(d[2]<<8|d[3]))return l(3,"wrong scanline width");g=new Uint8Array(4*b*g);if(!g||!g.length)return l(4,"unable to allocate buffer space");e=c=0;k=4*b;m=new Uint8Array(4);for(a=new Uint8Array(k);0<n&&e<d.byteLength;){if(e+4>d.byteLength)return l(1);m[0]=d[e++];m[1]=d[e++];m[2]=d[e++];m[3]=d[e++];if(2!=m[0]||2!=m[1]||(m[2]<<8|m[3])!=b)return l(3,"bad rgbe scanline format");for(f=0;f<k&&e<d.byteLength;){h=d[e++];(v=128<h)&&(h-=128);if(0===h||f+h>k)return l(3,"bad scanline data");if(v)for(p=d[e++],v=0;v<h;v++)a[f++]=p;else a.set(d.subarray(e,e+h),f),f+=h,e+=h}h=b;for(v=0;v<h;v++)f=0,g[c]=a[v+f],f+=b,g[c+1]=a[v+f],f+=b,g[c+2]=a[v+f],f+=b,g[c+3]=a[v+f],c+=4;n--}return g},k=new Uint8Array(f);k.pos=0;f=function(d){var b,c,f=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,e=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*FORMAT=(\S+)\s*$/,p=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(d.pos>=d.byteLength||!(b=w(d)))return l(1,"no header found");if(!(c=b.match(/^#\?(\S+)$/)))return l(3,"bad initial token");a.valid|=1;a.programtype=c[1];for(a.string+=b+"\n";;){b=w(d);if(!1===b)break;a.string+=b+"\n";if("#"===b.charAt(0))a.comments+=b+"\n";else{if(c=b.match(f))a.gamma=parseFloat(c[1],10);if(c=b.match(e))a.exposure=parseFloat(c[1],10);if(c=b.match(h))a.valid|=2,a.format=c[1];if(c=b.match(p))a.valid|=4,a.height=parseInt(c[1],10),a.width=parseInt(c[2],10);if(a.valid&2&&a.valid&4)break}}return a.valid&2?a.valid&4?a:l(3,"missing image size specifier"):l(3,"missing format specifier")}(k);if(-1!==f){var x=f.width,y=f.height,n=n(k.subarray(k.pos),x,y);if(-1!==n){if(this.type===THREE.UnsignedByteType)var c=n,q=THREE.RGBEFormat,t=THREE.UnsignedByteType;else if(this.type===THREE.FloatType){c=function(c,b,f,k){var d=Math.pow(2,c[b+3]-128)/255;f[k+0]=c[b+0]*d;f[k+1]=c[b+1]*d;f[k+2]=c[b+2]*d};q=n.length/4*3;t=new Float32Array(q);for(k=0;k<q;k++)c(n,4*k,t,3*k);c=t;q=THREE.RGBFormat;t=THREE.FloatType}else console.error("THREE.RGBELoader: unsupported type: ",this.type);return{width:x,height:y,data:c,header:f.string,gamma:f.gamma,exposure:f.exposure,format:q,type:t}}}return null};THREE.RGBELoader.prototype.setType=function(f){this.type=f;return this};THREE.HDRCubeTextureLoader=function(f){this.manager=void 0!==f?f:THREE.DefaultLoadingManager;this.hdrLoader=new THREE.RGBELoader};THREE.HDRCubeTextureLoader.prototype.load=function(f,l,w,n,k){function x(b,d,k,e){var h=new THREE.FileLoader(q.manager);h.setPath(q.path);h.setResponseType("arraybuffer");h.load(l[b],function(e){t++;if(e=q.hdrLoader._parser(e)){if(f===THREE.FloatType){for(var a=e.data.length/4*3,h=new Float32Array(a),g=0;g<a;g++){var k=e.data,p=4*g,m=h,l=3*g,n=Math.pow(2,k[p+3]-128)/255;m[l+0]=k[p+0]*n;m[l+1]=k[p+1]*n;m[l+2]=k[p+2]*n}e.data=h}else if(f===THREE.HalfFloatType){a=e.data.length/4*3;h=new Uint16Array(a);for(g=0;g<a;g++)y(e.data,4*g,h,3*g);e.data=h}void 0!==e.image?c[b].images=e.image:void 0!==e.data&&(e=new THREE.DataTexture(e.data,e.width,e.height),e.format=c.format,e.type=c.type,e.encoding=c.encoding,e.minFilter=c.minFilter,e.magFilter=c.magFilter,e.generateMipmaps=c.generateMipmaps,c.images[b]=e);6===t&&(c.needsUpdate=!0,d&&d(c))}},k,e)}var y=function(){function b(b){c[0]=b;b=d[0];var e=b>>16&32768,f=b>>12&2047,a=b>>23&255;return 103>a?e:142<a?e|31744|((255==a?0:1)&&b&8388607):113>a?(f|=2048,e|(f>>114-a)+(f>>113-a&1)):e=(e|a-112<<10|f>>1)+(f&1)}var c=new Float32Array(1),d=new Int32Array(c.buffer);return function(c,d,f,a){var e=Math.pow(2,c[d+3]-128)/255;f[a+0]=b(c[d+0]*e);f[a+1]=b(c[d+1]*e);f[a+2]=b(c[d+2]*e)}}(),c=new THREE.CubeTexture;c.type=f;c.encoding=f===THREE.UnsignedByteType?THREE.RGBEEncoding:THREE.LinearEncoding;c.format=f===THREE.UnsignedByteType?THREE.RGBAFormat:THREE.RGBFormat;c.minFilter=c.encoding===THREE.RGBEEncoding?THREE.NearestFilter:THREE.LinearFilter;c.magFilter=c.encoding===THREE.RGBEEncoding?THREE.NearestFilter:THREE.LinearFilter;c.generateMipmaps=c.encoding!==THREE.RGBEEncoding;c.anisotropy=0;for(var q=this,t=0,d=0;d<l.length;d++)x(d,w,n,k);return c};THREE.HDRCubeTextureLoader.prototype.setPath=function(f){this.path=f;return this};


THREE.RGBELoader2=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.type=THREE.UnsignedByteType};THREE.RGBELoader2.prototype=Object.create(THREE.DataTextureLoader.prototype);THREE.RGBELoader2.prototype._parser=function(a){var p=function(b,c){switch(b){case 1:console.error("THREE.RGBELoader2 Read Error: "+(c||""));break;case 2:console.error("THREE.RGBELoader2 Write Error: "+(c||""));break;case 3:console.error("THREE.RGBELoader2 Bad File Format: "+(c||""));break;default:case 4:console.error("THREE.RGBELoader2: Error: "+(c||""))}return-1},r=function(b,c,f){c=c?c:1024;for(var l=b.pos,e,m=0,g="",d=String.fromCharCode.apply(null,new Uint16Array(b.subarray(l,l+128)));0>(e=d.indexOf("\n"))&&m<c&&l<b.byteLength;)g+=d,m+=d.length,l+=128,d+=String.fromCharCode.apply(null,new Uint16Array(b.subarray(l,l+128)));return-1<e?(!1!==f&&(b.pos+=m+e+1),g+d.slice(0,e)):!1},n=function(b,c,f){var l,e,m,g,d,a,k,q,n=f,h;if(8>c||32767<c||2!==b[0]||2!==b[1]||b[2]&128)return new Uint8Array(b);if(c!==(b[2]<<8|b[3]))return p(3,"wrong scanline width");f=new Uint8Array(4*c*f);if(!f||!f.length)return p(4,"unable to allocate buffer space");e=l=0;k=4*c;h=new Uint8Array(4);for(d=new Uint8Array(k);0<n&&e<b.byteLength;){if(e+4>b.byteLength)return p(1);h[0]=b[e++];h[1]=b[e++];h[2]=b[e++];h[3]=b[e++];if(2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=c)return p(3,"bad rgbe scanline format");for(a=0;a<k&&e<b.byteLength;){m=b[e++];(q=128<m)&&(m-=128);if(0===m||a+m>k)return p(3,"bad scanline data");if(q)for(g=b[e++],q=0;q<m;q++)d[a++]=g;else d.set(b.subarray(e,e+m),a),a+=m,e+=m}m=c;for(q=0;q<m;q++)a=0,f[l]=d[q+a],a+=c,f[l+1]=d[q+a],a+=c,f[l+2]=d[q+a],a+=c,f[l+3]=d[q+a],l+=4;n--}return f},g=function(b,c,a,l){var e=Math.pow(2,b[c+3]-128)/255;a[l+0]=b[c+0]*e;a[l+1]=b[c+1]*e;a[l+2]=b[c+2]*e},t=function(){function b(b){c[0]=b;b=a[0];var e=b>>16&32768,g=b>>12&2047,f=b>>23&255;return 103>f?e:142<f?e|31744|((255==f?0:1)&&b&8388607):113>f?(g|=2048,e|(g>>114-f)+(g>>113-f&1)):e=(e|f-112<<10|g>>1)+(g&1)}var c=new Float32Array(1),a=new Int32Array(c.buffer);return function(c,a,g,f){var d=Math.pow(2,c[a+3]-128)/255;g[f+0]=b(c[a+0]*d);g[f+1]=b(c[a+1]*d);g[f+2]=b(c[a+2]*d)}}(),u=new Uint8Array(a);u.pos=0;a=function(b){var c,a,g=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,e=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*FORMAT=(\S+)\s*$/,k=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,d={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(b.pos>=b.byteLength||!(c=r(b)))return p(1,"no header found");if(!(a=c.match(/^#\?(\S+)$/)))return p(3,"bad initial token");d.valid|=1;d.programtype=a[1];for(d.string+=c+"\n";;){c=r(b);if(!1===c)break;d.string+=c+"\n";if("#"===c.charAt(0))d.comments+=c+"\n";else{if(a=c.match(g))d.gamma=parseFloat(a[1],10);if(a=c.match(e))d.exposure=parseFloat(a[1],10);if(a=c.match(h))d.valid|=2,d.format=a[1];if(a=c.match(k))d.valid|=4,d.height=parseInt(a[1],10),d.width=parseInt(a[2],10);if(d.valid&2&&d.valid&4)break}}return d.valid&2?d.valid&4?d:p(3,"missing image size specifier"):p(3,"missing format specifier")}(u);if(-1!==a){var w=a.width,x=a.height,n=n(u.subarray(u.pos),w,x);if(-1!==n){switch(this.type){case THREE.UnsignedByteType:var h=n,k=THREE.RGBEFormat,v=THREE.UnsignedByteType;break;case THREE.FloatType:h=n.length/4*3;t=new Float32Array(h);for(k=0;k<h;k++)g(n,4*k,t,3*k);h=t;k=THREE.RGBFormat;v=THREE.FloatType;break;case THREE.HalfFloatType:h=n.length/4*3;g=new Uint16Array(h);for(k=0;k<h;k++)t(n,4*k,g,3*k);h=g;k=THREE.RGBFormat;v=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader2: unsupported type: ",this.type)}return{width:w,height:x,data:h,header:a.string,gamma:a.gamma,exposure:a.exposure,format:k,type:v}}}return null};THREE.RGBELoader2.prototype.setDataType=function(a){this.type=a;return this};THREE.RGBELoader2.prototype.setType=function(a){console.warn("THREE.RGBELoader2: .setType() has been renamed to .setDataType().");return this.setDataType(a)};THREE.RGBELoader2.prototype.load=function(a,p,r,n){return THREE.DataTextureLoader.prototype.load.call(this,a,function(a,n){switch(a.type){case THREE.UnsignedByteType:a.encoding=THREE.RGBEEncoding;a.minFilter=THREE.NearestFilter;a.magFilter=THREE.NearestFilter;a.generateMipmaps=!1;a.flipY=!0;break;case THREE.FloatType:a.encoding=THREE.LinearEncoding;a.minFilter=THREE.LinearFilter;a.magFilter=THREE.LinearFilter;a.generateMipmaps=!1;a.flipY=!0;break;case THREE.HalfFloatType:a.encoding=THREE.LinearEncoding,a.minFilter=THREE.LinearFilter,a.magFilter=THREE.LinearFilter,a.generateMipmaps=!1,a.flipY=!0}p&&p(a,n)},r,n)};


THREE.CubemapGenerator=function(a){this.renderer=a};THREE.CubemapGenerator.prototype.fromEquirectangular=function(a,b){b=b||{};var d=new THREE.Scene,c=new THREE.ShaderMaterial({type:"CubemapFromEquirect",uniforms:THREE.UniformsUtils.clone({tEquirect:{value:null}}),vertexShader:"\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t//include \x3ccommon\x3e\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection \x3d transformDirection( position, modelMatrix );\n\n\t\t\t\t#include \x3cbegin_vertex\x3e\n\t\t\t\t#include \x3cproject_vertex\x3e\n\n\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t//include \x3ccommon\x3e\n\t\t\t#define RECIPROCAL_PI 0.31830988618\n\t\t\t#define RECIPROCAL_PI2 0.15915494\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction \x3d normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV;\n\n\t\t\t\tsampleUV.y \x3d asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\t\t\t\tsampleUV.x \x3d atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t\tgl_FragColor \x3d texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t\t",side:THREE.BackSide,blending:THREE.NoBlending});c.uniforms.tEquirect.value=a;c=new THREE.Mesh(new THREE.BoxBufferGeometry(5,5,5),c);d.add(c);var f=new THREE.CubeCamera(1,10,b.resolution||512,{type:a.type,format:a.format,encoding:a.encoding,generateMipmaps:void 0!==b.generateMipmaps?b.generateMipmaps:a.generateMipmaps,minFilter:void 0!==b.minFilter?b.minFilter:a.minFilter,magFilter:void 0!==b.magFilter?b.magFilter:a.magFilter});f.update(this.renderer,d);c.geometry.dispose();c.material.dispose();return f.renderTarget};THREE.EquirectangularToCubeGenerator=function(){var a=new THREE.PerspectiveCamera(90,1,.1,10),b=new THREE.Scene,d=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),function(){var a=new THREE.ShaderMaterial({uniforms:{equirectangularMap:{value:null}},vertexShader:"varying vec3 localPosition;\n\r\n\t\t\t\t\n\r\n\t\t\t\tvoid main() {\n\r\n\t\t\t\t\tlocalPosition \x3d position;\n\r\n\t\t\t\t\tgl_Position \x3d projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\r\n\t\t\t\t}",fragmentShader:"#include \x3ccommon\x3e\n\r\n\t\t\t\tvarying vec3 localPosition;\n\r\n\t\t\t\tuniform sampler2D equirectangularMap;\n\r\n\t\t\t\t\n\r\n\t\t\t\tvec2 EquirectangularSampleUV(vec3 v) {\n\r\n\t\t\t\t\tvec2 uv \x3d vec2(atan(v.z, v.x), asin(v.y));\n\r\n\t\t\t\t\tuv *\x3d vec2(0.1591, 0.3183); // inverse atan\n\r\n\t\t\t\t\tuv +\x3d 0.5;\n\r\n\t\t\t\t\treturn uv;\n\r\n\t\t\t\t}\n\r\n\t\t\t\t\n\r\n\t\t\t\tvoid main() {\n\r\n\t\t\t\t\tvec2 uv \x3d EquirectangularSampleUV(normalize(localPosition));\n\r\n\t\t\t\t\tgl_FragColor \x3d texture2D(equirectangularMap, uv);\n\r\n\t\t\t\t}",blending:THREE.NoBlending});a.type="EquirectangularToCubeGenerator";return a}());d.material.side=THREE.BackSide;b.add(d);var c=function(a,b){b=b||{};this.sourceTexture=a;this.resolution=b.resolution||512;this.views=[{t:[1,0,0],u:[0,-1,0]},{t:[-1,0,0],u:[0,-1,0]},{t:[0,1,0],u:[0,0,1]},{t:[0,-1,0],u:[0,0,-1]},{t:[0,0,1],u:[0,-1,0]},{t:[0,0,-1],u:[0,-1,0]}];this.renderTarget=new THREE.WebGLRenderTargetCube(this.resolution,this.resolution,{format:b.format||this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:b.type||this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding})};c.prototype={constructor:c,update:function(c){var f=c.getRenderTarget();d.material.uniforms.equirectangularMap.value=this.sourceTexture;for(var g=0;6>g;g++){var e=this.views[g];a.position.set(0,0,0);a.up.set(e.u[0],e.u[1],e.u[2]);a.lookAt(e.t[0],e.t[1],e.t[2]);c.setRenderTarget(this.renderTarget,g);c.clear();c.render(b,a)}c.setRenderTarget(f);return this.renderTarget.texture},dispose:function(){this.renderTarget.dispose()}};return c}();

THREE.FirstPersonControls=function(q,g){function c(a,b){return function(){b.apply(a,arguments)}}this.object=q;this.target=new THREE.Vector3(0,0,0);this.domElement=void 0!==g?g:document;this.movementSpeed=1;this.lookSpeed=.005;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.heightMax=1;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.initialY=this.initialX=this.viewHalfY=this.viewHalfX=0;var d=!1,h,k,l,m,e=0,f=0,n=0,p=0;this.domElement!==document&&this.domElement.setAttribute("tabindex",-1);this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)};this.onMouseDown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a.stopPropagation();this.activeLook&&(d=!0,h=a.clientX,k=a.clientY);this.mouseDragOn=!0};this.onMouseUp=function(a){a.preventDefault();a.stopPropagation();this.activeLook&&(d=!1,n+=e,p+=f);this.mouseDragOn=!1};this.onMouseMove=function(a){this.domElement===document?1==d&&(l=a.clientX,m=a.clientY,e=(l-h)*this.lookSpeed,f=-(m-k)*this.lookSpeed,this.lon=n+e,this.lat=p+f):(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(a){if(!this.freeze){if(this.heightSpeed){var b=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=a*b*this.heightCoef}else this.autoSpeedFactor=0;a*=this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(a);this.moveLeft&&this.object.translateX(-a);this.moveRight&&this.object.translateX(a);this.moveUp&&this.object.translateY(a);this.moveDown&&this.object.translateY(-a);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=THREE.Math.degToRad(90-this.lat)+this.initialY;this.theta=THREE.Math.degToRad(this.lon)+this.initialX;this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));a=this.target;b=this.object.position;a.x=b.x+100*Math.sin(this.phi)*Math.cos(this.theta);a.y=b.y+100*Math.cos(this.phi);a.z=b.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(a)}};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousemove",c(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",c(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",c(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",c(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",c(this,this.onKeyUp),!1);this.handleResize()};